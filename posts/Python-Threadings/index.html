

<!DOCTYPE html>
<html lang="en" >



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/YXY.png">
  <link rel="icon" href="/img/YXY.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#c30000">
  <meta name="author" content="Xiyuan Yang">
  <meta name="keywords" content="Code">
  
    <meta name="description" content="This blog explains the basic concepts related to Python threads, including GIL, multithreading, multiprocessing, and asynchronous programming.">
<meta property="og:type" content="article">
<meta property="og:title" content="Python Threadings">
<meta property="og:url" content="https://xiyuanyang-code.github.io/posts/Python-Threadings/index.html">
<meta property="og:site_name" content="Xiyuan Yang&#39;s Blog">
<meta property="og:description" content="This blog explains the basic concepts related to Python threads, including GIL, multithreading, multiprocessing, and asynchronous programming.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xiyuanyang-code.github.io/img/cover/gil.jpg">
<meta property="article:published_time" content="2025-05-01T14:58:27.000Z">
<meta property="article:modified_time" content="2025-05-02T09:25:20.583Z">
<meta property="article:author" content="Xiyuan Yang">
<meta property="article:tag" content="Finished">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Tutorial">
<meta property="article:tag" content="GIL">
<meta property="article:tag" content="Threadings">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xiyuanyang-code.github.io/img/cover/gil.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Python Threadings - Xiyuan Yang&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xiyuanyang-code.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"â¡"},"progressbar":{"enable":true,"height_px":3,"color":"red","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"L7r0uGb0fafbzNvmBADCMH42-gzGzoHsz","app_key":"2Lr1fQ2rjhwRiUrDx0VOQyUm","server_url":null,"path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Xiyuan Yang&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/above/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>Intro</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archive</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Category</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tag</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="https://xiyuanyang-code.github.io/My-Resume/" target="_self">
                <i class="iconfont icon-code"></i>
                <span>Resume</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Else</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/FAQ/" target="_self">
                    <i class="iconfont icon-bug"></i>
                    <span>FAQ</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/links" target="_self">
                    <i class="iconfont icon-link-fill"></i>
                    <span>Links</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/All-posts/" target="_self">
                    <i class="iconfont icon-notebook"></i>
                    <span>All-posts</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Recordings/" target="_self">
                    <i class="iconfont icon-clipcheck"></i>
                    <span>recordings</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/resume/" target="_self">
                    <i class="iconfont icon-github-fill"></i>
                    <span>Github Introduction</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://github.com/xiyuanyang-code" target="_self">
                    <i class="iconfont icon-github-fill"></i>
                    <span>My Github</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://hexo.fluid-dev.com/" target="_self">
                    <i class="iconfont icon-copyright"></i>
                    <span>About Hexo</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://xiyuanyang-code.github.io/posts/Life-musings/" target="_self">
                    <i class="iconfont icon-brush"></i>
                    <span>Life Musing</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/place.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Python Threadings"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Xiyuan Yang
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-05-01 22:58" pubdate>
          May 1, 2025 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.6k words
        
      </span>
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Project"
        id="heading-9e727fdd3aec8274f46685441900280d" role="tab" data-toggle="collapse" href="#collapse-9e727fdd3aec8274f46685441900280d"
        aria-expanded="true"
      >
        Project
        <span class="list-group-count">(8)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-9e727fdd3aec8274f46685441900280d"
           role="tabpanel" aria-labelledby="heading-9e727fdd3aec8274f46685441900280d">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/MYGITHUB-Lightweight-speech-recognition-conversion-model/" title="MYGITHUB-Lightweight-Speech-Recognition-Conversion-Model"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">MYGITHUB-Lightweight-Speech-Recognition-Conversion-Model</span>
        </a>
      
    
      
      
        <a href="/posts/Python-numpy-cheatsheet/" title="Python-Numpy-Cheatsheet"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python-Numpy-Cheatsheet</span>
        </a>
      
    
      
      
        <a href="/posts/RAG-Blog-Content-Retrieval/" title="RAG-Blog-Content-Retrieval"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">RAG-Blog-Content-Retrieval</span>
        </a>
      
    
      
      
        <a href="/posts/Blog-Update-Fetching-Script/" title="Blog-Update-Fetching-Script"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Blog-Update-Fetching-Script</span>
        </a>
      
    
      
      
        <a href="/posts/CamelAI-automatic-essay-modification/" title="CamelAI-Automatic-Essay-Modification"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">CamelAI-Automatic-Essay-Modification</span>
        </a>
      
    
      
      
        <a href="/posts/My-Multi-Agents/" title="My Multi-Agents"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">My Multi-Agents</span>
        </a>
      
    
      
      
        <a href="/posts/Blog-Word-Counter/" title="Blog Word Counter"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Blog Word Counter</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Threadings/" title="Python Threadings"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">Python Threadings</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Python Threadings</h1>
            
            
              <div class="markdown-body">
                
                <style>
  html, body, .markdown-body {
    font-family: Georgia, sans, serif;
  }
</style>

<h1 id="Threads-and-Processes-in-Python"><a href="#Threads-and-Processes-in-Python" class="headerlink" title="Threads and Processes in Python"></a>Threads and Processes in Python</h1><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="çº¿ç¨‹å’Œè¿›ç¨‹"><a href="#çº¿ç¨‹å’Œè¿›ç¨‹" class="headerlink" title="çº¿ç¨‹å’Œè¿›ç¨‹"></a>çº¿ç¨‹å’Œè¿›ç¨‹</h3><ul>
<li><strong>çº¿ç¨‹</strong>ï¼ˆThreadingï¼‰ï¼šæ“ä½œç³»ç»Ÿè¿›è¡Œè®¡ç®—å’Œè°ƒåº¦çš„æœ€å°å•ä½ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å¯¹åº”çš„ä¸Šä¸‹æ–‡ã€‚</li>
<li><strong>è¿›ç¨‹</strong>ï¼ˆProcessingï¼‰ï¼šç”±è‹¥å¹²ä¸ªçº¿ç¨‹ç»„æˆï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥äº«æœ‰è¿™ä¸ªè¿›ç¨‹çš„å†…å­˜ï¼ˆ<strong>å˜é‡å…±äº«</strong>ï¼‰<ul>
<li><strong>è¿›ç¨‹æ˜¯ç¨‹åºçš„æ‰§è¡Œå®ä¾‹</strong>ï¼Œæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºï¼ˆCPUã€å†…å­˜ã€æ–‡ä»¶å¥æŸ„ç­‰ï¼‰çš„åŸºæœ¬å•ä½ã€‚</li>
<li>æ¯ä¸ªè¿›ç¨‹æœ‰ <strong>ç‹¬ç«‹çš„å†…å­˜ç©ºé—´</strong>ï¼Œè¿›ç¨‹é—´æ•°æ®éš”ç¦»ï¼ˆé»˜è®¤ä¸å…±äº«å˜é‡ï¼‰ã€‚</li>
<li>è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰éœ€è¦é€šè¿‡ç‰¹æ®Šæœºåˆ¶ï¼ˆå¦‚ç®¡é“ã€é˜Ÿåˆ—ã€å…±äº«å†…å­˜ç­‰ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åœ¨ç°åœ¨è®¡ç®—ä»»åŠ¡ä¸­å…·æœ‰å¾ˆé‡è¦çš„æ„ä¹‰ï¼Œå¯ä»¥å¾ˆå¤§çš„æå‡ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p>
<ul>
<li><p><strong>å¤šè¿›ç¨‹</strong>ï¼šåˆ©ç”¨å¤šæ ¸ CPU å¹¶è¡Œè®¡ç®—ï¼ˆå¦‚æœºå™¨å­¦ä¹ è®­ç»ƒï¼‰ã€‚</p>
</li>
<li><p><strong>å¤šçº¿ç¨‹</strong>ï¼šåœ¨ I&#x2F;O ç­‰å¾…æ—¶åˆ‡æ¢ä»»åŠ¡ï¼ˆå¦‚åŒæ—¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶ï¼‰ã€‚</p>
</li>
<li><p><strong>GUI åº”ç”¨</strong>ï¼šä¸»çº¿ç¨‹è´Ÿè´£ç•Œé¢æ¸²æŸ“ï¼Œå­çº¿ç¨‹å¤„ç†è€—æ—¶ä»»åŠ¡ï¼ˆé¿å…ç•Œé¢å¡é¡¿ï¼‰ã€‚</p>
</li>
<li><p><strong>Web æœåŠ¡å™¨</strong>ï¼šåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚</p>
</li>
</ul>
<h3 id="Race-Condition"><a href="#Race-Condition" class="headerlink" title="Race Condition"></a>Race Condition</h3><p>ä½†æ˜¯ï¼Œçº¿ç¨‹åœ¨æå‡æ•ˆç‡çš„åŒæ—¶ç‰ºç‰²äº†<strong>å®‰å…¨æ€§</strong>ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ç¨‹åºç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># Shared variables for threadings</span><br>balance = <span class="hljs-number">100</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">withdraw</span>(<span class="hljs-params">amount</span>):<br>    <span class="hljs-keyword">global</span> balance<br>    <span class="hljs-keyword">if</span> balance &gt;= amount:<br>        time.sleep(<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Getting money..., the amount is <span class="hljs-subst">&#123;amount&#125;</span>&quot;</span>)<br>        balance -= amount<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Get <span class="hljs-subst">&#123;amount&#125;</span>, <span class="hljs-subst">&#123;balance&#125;</span> remaining...&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error! You don&#x27;t have enough money!&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_thread_safe</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;test for race condition, safe mode for entering in queue&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;If they take turns to withdraw money at the counter in order.&quot;</span>)<br>    t1 = threading.Thread(target=withdraw, args=(<span class="hljs-number">80</span>,))<br>    t2 = threading.Thread(target=withdraw, args=(<span class="hljs-number">70</span>,))<br>    t3 = threading.Thread(target=withdraw, args=(<span class="hljs-number">50</span>,))<br>    t4 = threading.Thread(target=withdraw, args=(<span class="hljs-number">20</span>,))<br><br>    <span class="hljs-comment"># Starting multi-sessions, in queue</span><br>    t1.start()<br>    t1.join()<br>    t2.start()<br>    t2.join()<br>    t3.start()<br>    t3.join()<br>    t4.start()<br>    t4.join()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_thread_unsafe</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;test for race condition, unsafe mode for multithreads&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;If the four of them withdraw money at the counter simultaneously...&quot;</span>)<br>    t1 = threading.Thread(target=withdraw, args=(<span class="hljs-number">80</span>,))<br>    t2 = threading.Thread(target=withdraw, args=(<span class="hljs-number">70</span>,))<br>    t3 = threading.Thread(target=withdraw, args=(<span class="hljs-number">50</span>,))<br>    t4 = threading.Thread(target=withdraw, args=(<span class="hljs-number">20</span>,))<br><br>    <span class="hljs-comment"># Starting multi-sessions</span><br>    t1.start()<br>    t2.start()<br>    t3.start()<br>    t4.start()<br>    t1.join()<br>    t2.join()<br>    t3.join()<br>    t4.join()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># test for safe single-thread</span><br>    test_thread_safe()<br><br>    <span class="hljs-comment"># reset balance</span><br>    balance = <span class="hljs-number">100</span><br><br>    <span class="hljs-comment"># test for race condition: multithreads</span><br>    test_thread_unsafe()<br><br></code></pre></td></tr></table></figure>

<p>ç¨‹åºå®ç°äº†ä¸€ä¸ªç®€å•çš„æŸœå°æ¨¡æ‹Ÿå™¨ï¼Œæ¨¡æ‹Ÿäº†å››ä¸ªç”¨æˆ·<strong>ä»¥ä¸åŒçš„é¡ºåº</strong>å¯¹ç›¸åŒè´¦æˆ·å–é’±çš„ç»“æœã€‚</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">If</span> they <span class="hljs-keyword">take</span> turns <span class="hljs-keyword">to</span> withdraw money at the counter <span class="hljs-keyword">in</span> <span class="hljs-keyword">order</span>.<br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">80</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">80</span>, <span class="hljs-number">20</span> remaining...<br><span class="hljs-keyword">Error</span>! You don<span class="hljs-comment">&#x27;t have enough money!</span><br><span class="hljs-keyword">Error</span>! You don<span class="hljs-comment">&#x27;t have enough money!</span><br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">20</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">20</span>, <span class="hljs-number">0</span> remaining...<br><span class="hljs-keyword">If</span> the four <span class="hljs-keyword">of</span> them withdraw money at the counter simultaneously...<br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">80</span>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">70</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">80</span>, <span class="hljs-number">20</span> remaining...<br><br><span class="hljs-keyword">Get</span> <span class="hljs-number">70</span>, -<span class="hljs-number">50</span> remaining...<br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">50</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">50</span>, -<span class="hljs-number">100</span> remaining...<br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">20</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">20</span>, -<span class="hljs-number">120</span> remaining...<br></code></pre></td></tr></table></figure>

<p>ä¸€çœ‹è¾“å‡ºå°±å‘ç°äº†é—®é¢˜ï¼Œåœ¨<code>unsafe_for_multithreads</code>ä¸­ï¼Œé’±å‡ºç°äº†è´Ÿå€¼çš„æƒ…å†µï¼Œè€Œå¹¶æ²¡æœ‰åƒç¬¬ä¸€ç§æƒ…å†µä¸€æ ·è¾“å‡ºerrorã€‚</p>
<h4 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h4><p>å‡ºé”™çš„æ ¸å¿ƒé€»è¾‘åœ¨äº<strong>åœ¨åŒä¸€è¿›ç¨‹çš„è‹¥å¹²ä¸ªçº¿ç¨‹ä¸­</strong>ï¼Œä»–ä»¬å¯ä»¥å…±äº«å˜é‡å¹¶ä¸”å¯¹è¿™ä¸€ä¸ªå˜é‡åšä¿®æ”¹ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç çš„é€»è¾‘é”™è¯¯ã€‚</p>
<p>ä¾‹å¦‚ä¸Šé¢çš„å–é’±é€»è¾‘å…¶å®å°±æ˜¯ä¸€ä¸ª<code>while</code>å¾ªç¯ï¼Œå¦‚æœå››ä¸ªç”¨æˆ·ä¸€ä¸ªä¸ªæŒ‰é¡ºåºå–é’±ï¼ˆ<strong>ç¬¬äºŒä½ç”¨æˆ·ä¸ä¼šåœ¨ç¬¬ä¸€ä½ç”¨æˆ·å–é’±æ“ä½œæœªå®Œæˆçš„æ—¶å€™å¼€å§‹è‡ªå·±çš„å–é’±æ“ä½œ</strong>ï¼‰ï¼Œå¾ˆæ˜¾ç„¶<code>balance</code>çš„å€¼ä¼šè¢«æ­£ç¡®çš„æ›´æ–°ï¼Œall is wellã€‚ä½†æ˜¯å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œå››ä¸ªçº¿ç¨‹å‡ ä¹åŒæ—¶å¯åŠ¨ï¼ˆç¬¬å››ä¸ªçº¿ç¨‹å¯åŠ¨çš„æ—¶é—´æ—©äºç¬¬ä¸€ä¸ªçº¿ç¨‹ç»“æŸçš„æ—¶é—´ï¼‰ï¼Œè¿™å°±ä¼šå¯¼è‡´æ­¤æ—¶<code>balance -= amount</code>çš„æ ¸å¿ƒé€»è¾‘å¹¶æœªæ‰§è¡Œï¼Œå››ä¸ªwhileå¾ªç¯å…¨éƒ¨åˆ¤æ–­ä¸ºTrueï¼Œå¯¼è‡´è¶…å‡ºé™é¢çš„æ‰£æ¬¾ã€‚</p>
<blockquote>
<p>è¿™ä¼šå¸¦æ¥å¾ˆå¤šçš„é—®é¢˜ï¼Œåœ¨æ›´å¤æ‚çš„å‡½æ•°é€»è¾‘ä¸­å¯¹å˜é‡çš„ä¿®æ”¹æ›´åŠ åƒå˜ä¸‡åŒ–ï¼Œå‡ºé”™çš„ä¸¥é‡ç¨‹åº¦æ›´é«˜ã€‚</p>
</blockquote>
<h3 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h3><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹å¼æ˜¯å¯¹ç¨‹åº<strong>åŠ é”ï¼ˆLockï¼‰</strong>ï¼Œå³å¼ºåˆ¶<strong>è®©åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿è¡Œè¿™æ®µç¨‹åº</strong>ï¼Œè€Œä¸å…è®¸åŒæ—¶è¿è¡Œçš„æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># Shared variables for threadings</span><br>balance = <span class="hljs-number">100</span><br><br><span class="hljs-comment"># lock object</span><br>lock = threading.Lock()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">withdraw_with_locked</span>(<span class="hljs-params">amount</span>):<br>    <span class="hljs-keyword">global</span> balance<br>    <span class="hljs-keyword">with</span> lock:<br>        <span class="hljs-keyword">if</span> balance &gt;= amount:<br>            time.sleep(<span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Getting money..., the amount is <span class="hljs-subst">&#123;amount&#125;</span>&quot;</span>)<br>            balance -= amount<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Get <span class="hljs-subst">&#123;amount&#125;</span>, <span class="hljs-subst">&#123;balance&#125;</span> remaining...&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error! You don&#x27;t have enough money!&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_thread_unsafe_with_locked</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;test for race condition, unsafe mode for multithreads, but with lock&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;If the four of them withdraw money at the counter simultaneously..., but with lockğŸ˜‹!&quot;</span>)<br>    t1 = threading.Thread(target=withdraw_with_locked, args=(<span class="hljs-number">80</span>,))<br>    t2 = threading.Thread(target=withdraw_with_locked, args=(<span class="hljs-number">70</span>,))<br>    t3 = threading.Thread(target=withdraw_with_locked, args=(<span class="hljs-number">50</span>,))<br>    t4 = threading.Thread(target=withdraw_with_locked, args=(<span class="hljs-number">20</span>,))<br><br>    <span class="hljs-comment"># Starting multi-sessions</span><br>    t1.start()<br>    t2.start()<br>    t3.start()<br>    t4.start()<br>    t1.join()<br>    t2.join()<br>    t3.join()<br>    t4.join()<br><br></code></pre></td></tr></table></figure>

<p>ç¨‹åºçš„è¾“å‡ºæ˜¾ç¤ºå–é’±çš„é€»è¾‘æ­£å¸¸ï¼</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">If</span> the four <span class="hljs-keyword">of</span> them withdraw money at the counter simultaneously..., but <span class="hljs-keyword">with</span> lockğŸ˜‹!<br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">80</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">80</span>, <span class="hljs-number">20</span> remaining...<br><span class="hljs-keyword">Error</span>! You don<span class="hljs-comment">&#x27;t have enough money!</span><br><span class="hljs-keyword">Error</span>! You don<span class="hljs-comment">&#x27;t have enough money!</span><br>Getting money..., the amount <span class="hljs-built_in">is</span> <span class="hljs-number">20</span><br><span class="hljs-keyword">Get</span> <span class="hljs-number">20</span>, <span class="hljs-number">0</span> remaining...<br></code></pre></td></tr></table></figure>

<h2 id="Lock-Againâ€¦"><a href="#Lock-Againâ€¦" class="headerlink" title="Lock Againâ€¦"></a>Lock Againâ€¦</h2><p>é”æœ€åŸå§‹çš„è®¾è®¡æ˜¯éå¸¸ç®€å•ç²—æš´çš„ï¼Œä»–é€šè¿‡çº¿ç¨‹ä¹‹é—´çš„<strong>å¯¹å˜é‡çš„è¯»å†™æƒé™</strong>æ¥ä¿è¯ç¨‹åºé€»è¾‘çš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯é”æœ¬èº«çš„è®¾è®¡ä¹Ÿä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜ï¼Œä¸‹é¢ç®€å•ä»‹ç»<strong>æ­»é”</strong>ï¼Œè¿™ä¸€ä¸ªéå¸¸ç»å…¸çš„é”é—®é¢˜ã€‚</p>
<h3 id="Dead-Lock"><a href="#Dead-Lock" class="headerlink" title="Dead Lock"></a>Dead Lock</h3><p>æ­»é”æ˜¯æŒ‡ <strong>å¤šä¸ªçº¿ç¨‹&#x2F;è¿›ç¨‹å› äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºè€Œæ— é™é˜»å¡</strong> çš„æƒ…å†µã€‚ä¾‹å¦‚ä¸¤ä¸ªçº¿ç¨‹å„è‡ªæŒæœ‰é”Aå’Œé”Bï¼ŒåŒæ—¶è¯•å›¾è·å–å¯¹æ–¹çš„é”ã€‚</p>
<h4 id="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼ˆCoffmanæ¡ä»¶ï¼‰"><a href="#æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼ˆCoffmanæ¡ä»¶ï¼‰" class="headerlink" title="æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼ˆCoffmanæ¡ä»¶ï¼‰"></a>æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼ˆCoffmanæ¡ä»¶ï¼‰</h4><ol>
<li><strong>äº’æ–¥æ¡ä»¶</strong>ï¼šèµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å ç”¨ã€‚</li>
<li><strong>å æœ‰å¹¶ç­‰å¾…</strong>ï¼šçº¿ç¨‹æŒæœ‰è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œå¹¶ç­‰å¾…è·å–å…¶ä»–èµ„æºã€‚</li>
<li><strong>éæŠ¢å æ¡ä»¶</strong>ï¼šå·²åˆ†é…çš„èµ„æºä¸èƒ½è¢«å¼ºåˆ¶å‰¥å¤ºã€‚</li>
<li><strong>å¾ªç¯ç­‰å¾…</strong>ï¼šå¤šä¸ªçº¿ç¨‹å½¢æˆç¯å½¢ç­‰å¾…é“¾ï¼ˆå¦‚T1ç­‰T2ï¼ŒT2ç­‰T1ï¼‰ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><br>lock_a = threading.Lock()<br>lock_b = threading.Lock()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">thread_1</span>():<br>    <span class="hljs-keyword">with</span> lock_a:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 acquired lock A&quot;</span>)<br>        <span class="hljs-keyword">with</span> lock_b:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 acquired lock B&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished!&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">thread_2</span>():<br>    <span class="hljs-keyword">with</span> lock_b:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 acquired lock B&quot;</span>)<br>        <span class="hljs-keyword">with</span> lock_a:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 acquired lock A&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished!&quot;</span>)<br><br><br>t1 = threading.Thread(target=thread_1)<br>t2 = threading.Thread(target=thread_2)<br>t1.start()<br>t2.start()<br>t1.join()<br>t2.join()<br><br></code></pre></td></tr></table></figure>

<p>ç¨‹åºåœ¨è¾“å‡º<code>Thread 1 acquired lock AThread 2 acquired lock B</code>ä¹‹åå°±ä¸å†è¾“å‡ºä»»ä½•çš„å†…å®¹ï¼Œå‡ºç°äº†å¡æ­»çš„æƒ…å†µã€‚</p>
<p>ä¸€ç§æ¯”è¾ƒæ™®éçš„è§£å†³åŠæ³•å°±æ˜¯<strong>è®¾ç½®timeout</strong>ï¼Œè®¾ç½®ç­‰å¾…çš„æœ€å¤§æ—¶é—´ã€‚ï¼ˆè¿™åªæ˜¯ä¿è¯ç¨‹åºä¸ä¼šä¸€ç›´å¡æ­»ï¼Œå¹¶æ²¡æœ‰è§£å†³å®é™…é—®é¢˜ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">thread_1_timeout</span>():<br>    <span class="hljs-keyword">if</span> lock_a.acquire(timeout=<span class="hljs-number">2</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 acquired lock A&quot;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> lock_b.acquire(timeout=<span class="hljs-number">2</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 acquired lock B&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 finished!&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 could not acquire lock B, releasing lock A&quot;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            lock_a.release()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 1 could not acquire lock A&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">thread_2_timeout</span>():<br>    <span class="hljs-keyword">if</span> lock_b.acquire(timeout=<span class="hljs-number">2</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 acquired lock B&quot;</span>)<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> lock_a.acquire(timeout=<span class="hljs-number">2</span>):<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 acquired lock A&quot;</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 finished!&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 could not acquire lock A, releasing lock B&quot;</span>)<br>        <span class="hljs-keyword">finally</span>:<br>            lock_b.release()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Thread 2 could not acquire lock B&quot;</span>)<br><br><br>t1 = threading.Thread(target=thread_1_timeout)<br>t2 = threading.Thread(target=thread_2_timeout)<br>t1.start()<br>t2.start()<br>t1.join()<br>t2.join()<br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Thread</span> <span class="hljs-number">1</span> acquired lock AThread <span class="hljs-number">2</span> acquired lock B<br><br><span class="hljs-attribute">Thread</span> <span class="hljs-number">2</span> could not acquire lock A, releasing lock B<br><span class="hljs-attribute">Thread</span> <span class="hljs-number">1</span> acquired lock B<br><span class="hljs-attribute">Thread</span> <span class="hljs-number">1</span> finished!<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å‘ç°ï¼Œ<code>Thread 2 could not acquire lock A, releasing lock B</code>è¿™é‡Œè¶…æ—¶åè§£é”ï¼Œç„¶åè¿™ä¸ªæ­»é”é—®é¢˜å°±è¢«è§£å¼€äº†ã€‚</p>
<h2 id="GIL-Global-Interpreter-Lock"><a href="#GIL-Global-Interpreter-Lock" class="headerlink" title="GIL (Global Interpreter Lock)"></a>GIL (Global Interpreter Lock)</h2><p>åœ¨ç°ä»£C++ä¸­ï¼Œæ™ºèƒ½æŒ‡é’ˆä½¿ç”¨<code>Reference count</code>æ¥å®ç°å¼•ç”¨è®¡æ•°ï¼Œè¿›è€Œè‡ªåŠ¨åŒ–å›æ”¶å†…å­˜ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ï¼ˆæ— é”ï¼‰çš„æƒ…å†µä¸‹ï¼Œå¾ˆå®¹æ˜“å‡ºç°Race Conditionçš„é—®é¢˜ã€‚</p>
<p>å› æ­¤ï¼ŒGILï¼ˆGlobal Interpreter Lockï¼‰æ˜¯ <strong>CPython è§£é‡Šå™¨</strong>ï¼ˆPython å®˜æ–¹å®ç°ï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ª <strong>äº’æ–¥é”ï¼ˆMutexï¼‰</strong>ï¼Œç”¨äºä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œ Python å­—èŠ‚ç ã€‚å®ƒçš„è®¾è®¡åˆè¡·æ˜¯ <strong>ç®€åŒ– CPython çš„å†…å­˜ç®¡ç†</strong>ï¼Œå°¤å…¶æ˜¯ <strong>å¼•ç”¨è®¡æ•°çš„çº¿ç¨‹å®‰å…¨</strong>ã€‚</p>
<h3 id="Impact-of-GIL"><a href="#Impact-of-GIL" class="headerlink" title="Impact of GIL"></a>Impact of GIL</h3><p>æ²¡æœ‰ GILï¼ŒPython éœ€è¦ä¸ºæ‰€æœ‰æ•°æ®ç»“æ„ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ï¼‰å®ç°ç»†ç²’åº¦é”ï¼Œæå¤§å¢åŠ ä»£ç å¤æ‚åº¦ã€‚è€ŒGILéå¸¸å®Œç¾çš„unifyäº†è¿™ä¸€ç‚¹ã€‚åŒæ—¶ï¼ŒGILå‡å°‘äº†é”å¼€é”€ï¼Œä½¿å…¶åœ¨å•çº¿ç¨‹ä¸­è·å¾—æ›´å¥½çš„æ—¶é—´æ€§èƒ½ã€‚</p>
<p>ä½†æ˜¯GILä¹Ÿæœ‰å¾ˆå¤§çš„é™åˆ¶ï¼Œä»–ä¼šå¯¼è‡´<strong>å¤šæ ¸CPUçš„CPUå¯†é›†å‹ä»»åŠ¡</strong>æ—¶é—´ä¸‹é™ï¼Œå› ä¸ºGILéœ€è¦ä¿è¯åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿›è¡ŒPythonå­—èŠ‚ç ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_down</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>        n -= <span class="hljs-number">1</span><br><br><span class="hljs-comment"># Single-threaded execution</span><br>start_time = time.time()  <span class="hljs-comment"># Start timing</span><br>count_down(<span class="hljs-number">500_000_000</span>) <br>end_time = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Single-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br><span class="hljs-comment"># Multi-threaded execution (theoretically faster, but actually slower due to GIL)</span><br>start_time = time.time()  <span class="hljs-comment"># Start timing</span><br>t1 = threading.Thread(target=count_down, args=(<span class="hljs-number">250_000_000</span>,))<br>t2 = threading.Thread(target=count_down, args=(<span class="hljs-number">250_000_000</span>,))<br>t1.start()<br>t2.start()<br>t1.join()<br>t2.join()<br>end_time = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Multi-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds (due to GIL overhead)&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ä¸Šæ–‡çš„ç¨‹åºæ¨¡æ‹ŸCPUå¯†é›†å‹ä»»åŠ¡ï¼Œç”±äºGILå¼ºåˆ¶ä¿è¯<strong>åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒPythonå­—èŠ‚ç </strong>ï¼Œè¿™ä¼šå¯¼è‡´<strong>ä¼ªå¤šçº¿ç¨‹</strong>çš„å‡ºç°ï¼š</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Single-threaded execution <span class="hljs-built_in">time</span>: <span class="hljs-number">3.81</span> <span class="hljs-built_in">seconds</span><br>Multi-threaded execution <span class="hljs-built_in">time</span>: <span class="hljs-number">3.98</span> <span class="hljs-built_in">seconds</span> (due <span class="hljs-built_in">to</span> GIL overhead)<br></code></pre></td></tr></table></figure>

<blockquote>
<p>Python 3.12 å¯¹ GIL è¿›è¡Œäº†é‡å¤§æ”¹è¿›ï¼ˆ<a target="_blank" rel="noopener" href="https://peps.python.org/pep-0703/">PEP 703</a>ï¼‰ï¼Œ<strong>å…è®¸æ›´ç»†ç²’åº¦çš„çº¿ç¨‹åˆ‡æ¢</strong>ï¼Œå°¤å…¶æ˜¯åœ¨çº¯ CPU å¾ªç¯ä¸­ã€‚</p>
<ul>
<li><strong>æ—§ç‰ˆæœ¬ï¼ˆå¦‚ Python 3.11ï¼‰</strong>ï¼šGIL å¯¼è‡´å¤šçº¿ç¨‹åœ¨ CPU å¯†é›†å‹ä»»åŠ¡ä¸­æ›´æ…¢ã€‚</li>
<li><strong>æ–°ç‰ˆæœ¬ï¼ˆPython 3.12+ï¼‰</strong>ï¼šGIL çš„åˆ‡æ¢ç­–ç•¥ä¼˜åŒ–ï¼Œä½¿å¾—ç®€å•å¾ªç¯ï¼ˆå¦‚ <code>n -= 1</code>ï¼‰å¯èƒ½è¡¨ç°å‡ºä¼ªå¹¶è¡ŒåŠ é€Ÿã€‚</li>
</ul>
<p>æµ‹è¯•ä¸Šæ–‡ä»£ç åŠ¡å¿…ä¸‹è°ƒPythonç‰ˆæœ¬ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼ŒGILåªå¯¹Pythonå­—èŠ‚ç åšäº†çº¦æŸï¼Œ<strong>åœ¨é¢å¯¹IOå¯†é›†å‹</strong>çš„ä»»åŠ¡æ—¶å¤šçº¿ç¨‹å¯ä»¥å®ç°å¾ˆå¤§ç¨‹åº¦çš„åŠ é€Ÿã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cpu_task</span>(<span class="hljs-params">n: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;simulation of CPU intensive task</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Args:</span><br><span class="hljs-string">        n (int): the total count steps</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>        n -= <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;CPU task ends&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">io_task</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;simulation of IO-intensive task&quot;&quot;&quot;</span><br>    time.sleep(<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_task_cpu</span>(<span class="hljs-params">task_function</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;test for GIL in CPU-intensive task&quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Test for CPU-intensive task:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Test for single threaded:&quot;</span>)<br>    start_time = time.time()<br>    task_function(<span class="hljs-number">500_000_000</span>)<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Single-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Test for multi threaded:&quot;</span>)<br>    start_time = time.time()<br>    t1 = threading.Thread(target=task_function, args=(<span class="hljs-number">250_000_000</span>,))<br>    t2 = threading.Thread(target=task_function, args=(<span class="hljs-number">250_000_000</span>,))<br>    t1.start()<br>    t2.start()<br>    t1.join()<br>    t2.join()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Multi-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_task_io</span>(<span class="hljs-params">task_function</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nTest for Io-intensive task:&quot;</span>)<br>    <span class="hljs-comment"># single threads:</span><br>    start_time = time.time()<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>        io_task()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Single-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br>    threads = [threading.Thread(target=io_task) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>    start_time = time.time()<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.start()<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.join()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Multi-threaded execution time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    test_task_cpu(cpu_task)<br>    test_task_io(io_task)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Test </span>for CPU-intensive task:<br><span class="hljs-keyword">Test </span>for single threaded:<br>CPU task ends<br>Single-threaded execution time: 20.48 seconds<br><span class="hljs-keyword">Test </span>for multi threaded:<br>CPU task ends<br>CPU task ends<br>Multi-threaded execution time: 20.52 seconds<br><br><span class="hljs-keyword">Test </span>for Io-intensive task:<br>Single-threaded execution time: 10.01 seconds<br>Multi-threaded execution time: 1.01 seconds<br></code></pre></td></tr></table></figure>

<div class="note note-primary">
            <h3 id="GILæ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ"><a href="#GILæ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ" class="headerlink" title="GILæ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ"></a>GILæ˜¯ä¸‡èƒ½çš„å—ï¼Ÿ</h3><p>GILä½œä¸ºå…¨å±€é”ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è¢«ä¿æŠ¤ï¼ä¾‹å¦‚ä¸Šé¢çš„é“¶è¡Œå–æ¬¾æ“ä½œå°±ä¸ä¼šå—åˆ°GILçš„ä¿æŠ¤ï¼Œè€Œéœ€è¦<strong>æ˜¾å¼åŒæ­¥é”</strong>æ‰å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚</p><p>GILçš„è®¾è®¡åˆè¡·å°±æ˜¯<strong>ä¿è¯å¼•ç”¨è®¡æ•°çš„å®‰å…¨æ€§</strong>ï¼Œå› æ­¤å¯ä»¥ä¿æŠ¤ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li><strong>Pythonå­—èŠ‚ç æ‰§è¡Œçš„åŸå­æ€§</strong>ï¼š<ul><li>å•ä¸ªPythonå­—èŠ‚ç æŒ‡ä»¤çš„æ‰§è¡Œæ˜¯åŸå­çš„ï¼ˆä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼‰</li><li>ä¾‹å¦‚ï¼š<code>x = 1</code>è¿™æ ·çš„ç®€å•èµ‹å€¼æ“ä½œæ˜¯åŸå­çš„</li></ul></li><li><strong>å†…ç½®ç±»å‹çš„ç®€å•æ“ä½œ</strong>ï¼š<ul><li>å¯¹ç®€å•æ•°æ®ç±»å‹ï¼ˆå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ï¼‰çš„å•ä¸ªæ“ä½œé€šå¸¸æ˜¯åŸå­çš„</li><li>ä¾‹å¦‚ï¼š<code>x += 1</code>ï¼ˆå¦‚æœxæ˜¯æ•´æ•°ï¼‰åœ¨Pythonä¸­æ˜¯åŸå­çš„</li></ul></li><li><strong>è§£é‡Šå™¨å†…éƒ¨çŠ¶æ€</strong>ï¼š<ul><li>ä¿æŠ¤<strong>CPythonè§£é‡Šå™¨å†…éƒ¨æ•°æ®ç»“æ„</strong>ä¸è¢«å¤šçº¿ç¨‹ç ´å</li><li>ç¡®ä¿å¼•ç”¨è®¡æ•°ç­‰æœºåˆ¶åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å®‰å…¨</li></ul></li></ol><p>GIL<strong>ä¸èƒ½ä¿æŠ¤çš„å†…å®¹</strong></p><ol><li><strong>å¤åˆæ“ä½œ</strong>ï¼š<ul><li>éœ€è¦å¤šä¸ªæ­¥éª¤&#x2F;å­—èŠ‚ç çš„æ“ä½œï¼ˆå¦‚æ£€æŸ¥åä¿®æ”¹ï¼‰</li><li>ä¾‹å¦‚ï¼š<code>if x &gt; 0: x -= 1</code>ï¼ˆæ£€æŸ¥+ä¿®æ”¹ä¸æ˜¯åŸå­çš„ï¼‰</li></ul></li><li><strong>I&#x2F;Oæ“ä½œæœŸé—´</strong>ï¼š<ul><li>æ‰§è¡ŒI&#x2F;Oæ“ä½œï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ã€time.sleepï¼‰æ—¶ä¼šé‡Šæ”¾GIL</li><li>å…¶ä»–çº¿ç¨‹å¯ä»¥åœ¨I&#x2F;Oæ“ä½œæœŸé—´æ‰§è¡Œ</li></ul></li><li><strong>æ‰©å±•æ¨¡å—ä¸­çš„æ“ä½œ</strong>ï¼š<ul><li>Cæ‰©å±•æ¨¡å—å¯ä»¥æ˜¾å¼é‡Šæ”¾GIL</li><li>NumPyç­‰ç§‘å­¦è®¡ç®—åº“ç»å¸¸è¿™æ ·åšä»¥æé«˜æ€§èƒ½</li></ul></li><li><strong>åº”ç”¨ç¨‹åºçº§åˆ«çš„æ•°æ®ä¸€è‡´æ€§</strong>ï¼š<ul><li>ä¸ä¿è¯åº”ç”¨ç¨‹åºé€»è¾‘çš„æ­£ç¡®æ€§</li><li>å¼€å‘è€…ä»éœ€å¯¹å…±äº«æ•°æ®çš„å¤åˆæ“ä½œä½¿ç”¨é”</li></ul></li></ol>
          </div>

<h2 id="Multi-Processing"><a href="#Multi-Processing" class="headerlink" title="Multi-Processing"></a>Multi-Processing</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><p>ç”±äºGILçš„é™åˆ¶ï¼ŒPythonçš„å¤šçº¿ç¨‹ä¸€ç›´è¢«è¯Ÿç—…æˆ<strong>ä¼ªå¤šçº¿ç¨‹</strong>ï¼Œå› ä¸ºä»–å¹¶æ²¡æœ‰ç”¨åˆ°å¤šæ ¸CPUçš„åŠ é€Ÿèƒ½åŠ›ã€‚å¤šçº¿ç¨‹ç”±äºGILè¢«è¿«é€€åŒ–ä¸ºé˜»å¡çš„å•çº¿ç¨‹ï¼Œå¯¼è‡´æ—¶é—´éå¸¸çš„æ…¢ã€‚</p>
<p>ä¸€ç§å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨<strong>å¤šè¿›ç¨‹</strong>ï¼å¤šè¿›ç¨‹å¯ä»¥ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œå› ä¸ºæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„Pythonè§£é‡Šå™¨å’Œå†…å­˜ç©ºé—´ï¼Œå› æ­¤ä¹Ÿæœ‰è‡ªå·±çš„GILã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Worker <span class="hljs-subst">&#123;num&#125;</span> running in process <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    processes = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = multiprocessing.Process(target=worker, args=(i,))<br>        processes.append(p)<br>        p.start()<br><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:<br>        p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;All processes finished&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Worker</span> <span class="hljs-number">0</span> running in process <span class="hljs-number">8140</span><br><span class="hljs-attribute">Worker</span> <span class="hljs-number">1</span> running in process <span class="hljs-number">8141</span><br><span class="hljs-attribute">Worker</span> <span class="hljs-number">2</span> running in process <span class="hljs-number">8142</span><br><span class="hljs-attribute">Worker</span> <span class="hljs-number">3</span> running in process <span class="hljs-number">8143</span><br><span class="hljs-attribute">Worker</span> <span class="hljs-number">4</span> running in process <span class="hljs-number">8144</span><br><span class="hljs-attribute">All</span> processes finished<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æ¥æ”¹å†™ä¸Šé¢çš„CPUå¯†é›†å‹ä»»åŠ¡ï¼Œå……åˆ†å‘æŒ¥å¤šæ ¸CPUçš„ä¼˜åŠ¿ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">multiprocess_cpu_task</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Using multi-processing&quot;</span>)<br>    start_time = time.time()<br>    processes = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = multiprocessing.Process(target=cpu_task, args=(<span class="hljs-number">100_000_000</span>,))<br>        processes.append(p)<br>        p.start()<br><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:<br>        p.join()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;All processes finished, time: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span>&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Test </span>for CPU-intensive task:<br><span class="hljs-keyword">Test </span>for single threaded:<br>CPU task ends<br>Single-threaded execution time: 23.63 seconds<br><span class="hljs-keyword">Test </span>for multi threaded:<br>CPU task ends<br>CPU task ends<br>Multi-threaded execution time: 21.67 seconds<br>Using multi-processing<br>CPU task ends<br>CPU task ends<br>CPU task ends<br>CPU task ends<br>CPU task ends<br>All processes finished, time: 4.44<br></code></pre></td></tr></table></figure>

<blockquote>
<p>ä½¿ç”¨å¤šè¿›ç¨‹å°±å¯ä»¥ç»•å¼€é”ï¼Œå®ç°å¤šæ ¸CPUçš„åŠ é€Ÿï¼</p>
</blockquote>
<h3 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h3><h4 id="è¿›ç¨‹æ± "><a href="#è¿›ç¨‹æ± " class="headerlink" title="è¿›ç¨‹æ± "></a>è¿›ç¨‹æ± </h4><p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨çš„<code>append</code>æ¥å®ç°å¤šè¿›ç¨‹çš„ç®¡ç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<strong>è¿›ç¨‹æ± </strong>æ¥å®ç°è¿™ä¸€éƒ¨åˆ†æ›´åŠ é«˜æ•ˆçš„å®ç°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x * x<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">with</span> Pool(processes=<span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> pool: <br>        <span class="hljs-comment"># åŒæ­¥æ‰§è¡Œ</span><br>        result = pool.apply(worker, (<span class="hljs-number">10</span>,))<br>        <span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># è¾“å‡º: 100</span><br>        <br>        <span class="hljs-comment"># å¼‚æ­¥æ‰§è¡Œ</span><br>        result = pool.apply_async(worker, (<span class="hljs-number">20</span>,))<br>        <span class="hljs-built_in">print</span>(result.get())  <span class="hljs-comment"># è¾“å‡º: 400</span><br>        <br>        <span class="hljs-comment"># mapæ–¹æ³•</span><br>        results = pool.<span class="hljs-built_in">map</span>(worker, <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>))<br>        <span class="hljs-built_in">print</span>(results)  <span class="hljs-comment"># è¾“å‡º: [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]</span><br>        <br>        <span class="hljs-comment"># imapæ–¹æ³•(æƒ°æ€§æ±‚å€¼)</span><br>        <span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> pool.imap(worker, <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)):<br>            <span class="hljs-built_in">print</span>(res)  <span class="hljs-comment"># ä¾æ¬¡è¾“å‡º: 0, 1, 4, 9, 16</span><br></code></pre></td></tr></table></figure>

<ul>
<li>åŒæ­¥æ‰§è¡Œ å’Œ å¼‚æ­¥æ‰§è¡Œ è§ä¸‹æ–‡</li>
<li>mapæ–¹æ³•è¡¨ç¤ºå¯¹<code>range(10)</code>çš„æ¯ä¸€ä¸ªå€¼è°ƒç”¨å‡½æ•°ï¼Œæœ€åè¿”å›ä¸€ä¸ªåˆ—è¡¨</li>
<li><code>imap</code>æ˜¯<strong>æƒ°æ€§æ±‚å€¼</strong>ï¼Œæœ€åä¼šè¿­ä»£è¾“å‡ºæ¯ä¸€ä¸ªç­”æ¡ˆï¼ˆæ—¶é—´æ›´æ…¢ï¼Œä½†å†…å­˜æ•ˆç‡æ›´é«˜ï¼‰</li>
</ul>
<h4 id="è¿›ç¨‹é—´é€šä¿¡-IPC"><a href="#è¿›ç¨‹é—´é€šä¿¡-IPC" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡(IPC)"></a>è¿›ç¨‹é—´é€šä¿¡(IPC)</h4><p>è¿›ç¨‹ä¹‹é—´çš„GILï¼Œå†…å­˜ç­‰èµ„æºéƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œä½†æ˜¯å¤šè¿›ç¨‹ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡Œé€šä¿¡ã€‚</p>
<h5 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h5><p>ä½¿ç”¨é˜Ÿåˆ—çš„pushå’Œpopå¯ä»¥å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Queue<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker</span>(<span class="hljs-params">q</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID2: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    q.put(<span class="hljs-string">&quot;Hello from child process&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message sent from subprocess: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    q = Queue()<br>    p = Process(target=worker, args=(q,))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID1: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message received to <span class="hljs-subst">&#123;os.getpid()&#125;</span>: <span class="hljs-subst">&#123;q.get()&#125;</span>&quot;</span>)<br>    p.join()<br><br></code></pre></td></tr></table></figure>

<h5 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h5><p>åœ¨CLIä¸­éå¸¸å¥½ç”¨ï¼Œåœ¨æœ¬è´¨ä¸Š<strong>ä¹Ÿæ˜¯ä¸€ç§å¤šè¿›ç¨‹é€šä¿¡</strong>çš„æ‰‹æ®µã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Queue, Pipe<br><span class="hljs-keyword">import</span> multiprocessing<br><span class="hljs-keyword">import</span> multiprocessing.connection<br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker_queue</span>(<span class="hljs-params">q: Queue</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID2: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    q.put(<span class="hljs-string">&quot;Hello from child process&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message sent from subprocess: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">worker_pipe</span>(<span class="hljs-params">conn: multiprocessing.connection.Connection</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID2: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    conn.send(<span class="hljs-string">&quot;Message from child&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message sent from subprocess: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    conn.close()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_pipe</span>():<br>    parent_conn, child_conn = Pipe()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID1: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    p = Process(target=worker_pipe, args=(child_conn,))<br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message received to <span class="hljs-subst">&#123;os.getpid()&#125;</span>: <span class="hljs-subst">&#123;parent_conn.recv()&#125;</span>&quot;</span>)<br>    p.join()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_queue</span>():<br>    q = Queue()<br>    p = Process(target=worker_queue, args=(q,))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;PID1: <span class="hljs-subst">&#123;os.getpid()&#125;</span>&quot;</span>)<br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message received to <span class="hljs-subst">&#123;os.getpid()&#125;</span>: <span class="hljs-subst">&#123;q.get()&#125;</span>&quot;</span>)<br>    p.join()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    test_pipe()<br>    test_queue()<br><br></code></pre></td></tr></table></figure>

<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">PID1:</span> <span class="hljs-number">14515</span><br><span class="hljs-symbol">PID2:</span> <span class="hljs-number">14516</span><br>Message sent <span class="hljs-keyword">from</span> subprocess: <span class="hljs-number">14516</span><br>Message received <span class="hljs-keyword">to</span> <span class="hljs-number">14515</span>: Message <span class="hljs-keyword">from</span> child<br><span class="hljs-symbol">PID1:</span> <span class="hljs-number">14515</span><br><span class="hljs-symbol">PID2:</span> <span class="hljs-number">14517</span><br>Message sent <span class="hljs-keyword">from</span> subprocess: <span class="hljs-number">14517</span><br>Message received <span class="hljs-keyword">to</span> <span class="hljs-number">14515</span>: Hello <span class="hljs-keyword">from</span> child process<br></code></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li><strong>Value&#x2F;Array</strong>: ç”¨äºå…±äº«åŸºæœ¬æ•°æ®ç±»å‹</li>
<li><strong>Manager</strong>: å¯ä»¥åˆ›å»ºå…±äº«çš„å¤æ‚æ•°æ®ç»“æ„(å¦‚å­—å…¸ã€åˆ—è¡¨)</li>
</ul>
<p>æ¥å®ç°å†…å­˜å†…å®¹çš„å…±äº«ï¼ˆå¯¹äºæ›´åŠ å¤æ‚çš„æ•°æ®ç»“æ„ï¼‰ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€ã€‚</p>
<h2 id="asyncio"><a href="#asyncio" class="headerlink" title="asyncio"></a><code>asyncio</code></h2><p>å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§ <strong>éé˜»å¡å¼å¹¶å‘æ¨¡å‹</strong>ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ <strong>åœ¨ç­‰å¾…I&#x2F;Oæ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ï¼‰æ—¶é‡Šæ”¾CPUèµ„æº</strong>ï¼Œè®©ç¨‹åºå¯ä»¥åŒæ—¶å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œä»è€Œæå‡æ•ˆç‡ã€‚å®ƒæ˜¯ç°ä»£é«˜å¹¶å‘ç¨‹åºï¼ˆå¦‚WebæœåŠ¡å™¨ã€çˆ¬è™«ï¼‰çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<blockquote>
<p>å¼‚æ­¥é€‚åˆäº<strong>IOå¯†é›†å‹ä»»åŠ¡</strong>è€Œé<strong>CPUå¯†é›†å‹ä»»åŠ¡</strong>ã€‚</p>
</blockquote>
<h3 id="åŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹"><a href="#åŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="åŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹"></a>åŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹</h3><p>é¢å¯¹IOå¯†é›†å‹ä»»åŠ¡ï¼Œç¨‹åºéœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´è¿›è¡ŒIOæ“ä½œçš„ç­‰å¾…ï¼Œä¾‹å¦‚ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥æˆ–è€…æ–‡ä»¶è¯»å†™ï¼Œè·å–è¯·æ±‚ç­‰ç­‰ï¼Œè¿™æˆä¸ºäº†ç¨‹åºè¿è¡Œçš„æ—¶é—´ç“¶é¢ˆã€‚åœ¨åŒæ­¥ç¼–ç¨‹ä¸­ï¼Œ<strong>æ¯ä¸ªæ“ä½œå¿…é¡»å®Œæˆåæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œ</strong>ã€‚<strong>å¼‚æ­¥ç¼–ç¨‹</strong>æ˜¯ä¸€ç§éé˜»å¡çš„ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨ç­‰å¾…I&#x2F;Oæ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ï¼‰å®Œæˆæ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸æ˜¯å¹²ç­‰ç€ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ"><a href="#æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µ"></a>æ ¸å¿ƒæ¦‚å¿µ</h3><ol>
<li><strong>äº‹ä»¶å¾ªç¯ (Event Loop)</strong>:<ul>
<li>å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œåç¨‹</li>
<li>ä¸æ–­æ£€æŸ¥å“ªäº›åç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œ</li>
<li>å¤„ç†I&#x2F;Oäº‹ä»¶å’Œå›è°ƒ</li>
</ul>
</li>
<li><strong>åç¨‹ (Coroutine)</strong>:<ul>
<li>å¯æš‚åœå’Œæ¢å¤çš„å‡½æ•°ï¼ˆå°±æ˜¯<strong>éœ€è¦IOå¯†é›†ç­‰å¾…çš„å‡½æ•°</strong>ï¼‰</li>
</ul>
</li>
<li><strong>Future&#x2F;Task</strong>:<ul>
<li>Futureè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆç»“æœ</li>
<li>Taskæ˜¯Futureçš„å­ç±»ï¼Œç”¨äºåŒ…è£…å’Œç®¡ç†åç¨‹çš„æ‰§è¡Œ</li>
</ul>
</li>
</ol>
<h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><ol>
<li>ç¨‹åºå¯åŠ¨<strong>äº‹ä»¶å¾ªç¯</strong></li>
<li>å°†åç¨‹æ³¨å†Œä¸ºä»»åŠ¡åŠ å…¥äº‹ä»¶å¾ªç¯</li>
<li>é‡åˆ°I&#x2F;Oæ“ä½œæ—¶ï¼Œ<strong>åç¨‹æš‚åœå¹¶é‡Šæ”¾æ§åˆ¶æƒ</strong></li>
<li>äº‹ä»¶å¾ªç¯æ‰§è¡Œå…¶ä»–å¯è¿è¡Œçš„ä»»åŠ¡</li>
<li>I&#x2F;Oæ“ä½œå®Œæˆåï¼Œäº‹ä»¶å¾ªç¯æ¢å¤æš‚åœçš„åç¨‹</li>
<li>é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆ</li>
</ol>
<h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><h4 id="Example1-Fetching-Urls"><a href="#Example1-Fetching-Urls" class="headerlink" title="Example1: Fetching Urls."></a>Example1: Fetching Urls.</h4><blockquote>
<p>Talk is cheap! Just show you my code.</p>
</blockquote>
<p>æˆ‘ä»¬è¿™é‡Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯çš„è¡Œä¸ºï¼Œä½¿ç”¨<code>requests</code>åº“æ¥è¿›è¡Œå¯¹ä¸‰ä¸ªç½‘ç«™çš„è®¿é—®ï¼Œç»Ÿè®¡<strong>éå¹¶å‘ï¼ˆåŒæ­¥ç¼–ç¨‹ï¼‰</strong>å’Œ<strong>å¼‚æ­¥ç¼–ç¨‹ï¼ˆå¹¶å‘ï¼‰</strong>çš„é€Ÿåº¦å·®å¼‚ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>aiohttp</code>æ¥å®ç°å¼‚æ­¥çš„httpè¯·æ±‚ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> aiohttp<br><br>urls = [<br>    <span class="hljs-string">&quot;https://github.com&quot;</span>,<br>    <span class="hljs-string">&quot;https://sjtu.edu.cn&quot;</span>,<br>    <span class="hljs-string">&quot;https://acm.sjtu.edu.cn/OnlineJudge/&quot;</span>,<br>    <span class="hljs-string">&quot;https://chat.deepseek.com/&quot;</span>,<br>    <span class="hljs-string">&quot;https://www.bilibili.com/&quot;</span>,<br>    <span class="hljs-string">&quot;https://stackoverflow.com/questions&quot;</span><br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_url_simple</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">try</span>:<br>        response = requests.get(url, timeout=<span class="hljs-number">10</span>)  <span class="hljs-comment"># è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 10 ç§’</span><br>        <span class="hljs-keyword">return</span> response.text<br>    <span class="hljs-keyword">except</span> requests.exceptions.Timeout:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Timeout occurred while fetching <span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">except</span> requests.exceptions.ConnectionError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Connection error occurred: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;An error occurred: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_for_simple</span>():<br>    <span class="hljs-comment"># Using the for-loop</span><br>    <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:<br>        content = fetch_url_simple(url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span> returns <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(content)&#125;</span> bytes&quot;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_url</span>(<span class="hljs-params">url</span>):<br>    timeout = aiohttp.ClientTimeout(total=<span class="hljs-number">10</span>)  <span class="hljs-comment"># è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º 10 ç§’</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession(timeout=timeout) <span class="hljs-keyword">as</span> session:<br>            <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(url) <span class="hljs-keyword">as</span> response:<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.text()<br>    <span class="hljs-keyword">except</span> asyncio.TimeoutError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Timeout occurred while fetching <span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_for_concurrency</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;: The test for fetching urls: test for concurrency&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># Task list</span><br>    tasks = [fetch_url(url) <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls]<br><br>    <span class="hljs-comment"># For all tasks: Concurrency</span><br>    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br><br>    <span class="hljs-keyword">for</span> url, content <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(urls, results):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;url&#125;</span> returns <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(content)&#125;</span> bytes&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    start_time = time.time()<br>    asyncio.run(test_for_concurrency())<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Total time for concurrency: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br>    start_time = time.time()<br>    test_for_simple()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Total time for no concurrency: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¿™é‡Œåªæ˜¯æœ€ç®€å•çš„ç½‘ç«™è¯·æ±‚æ¨¡æ‹Ÿï¼Œå¾ˆå¤šç½‘ç«™<strong>ä¼šå¯¹é«˜å¹¶å‘çš„ç½‘ç»œè¯·æ±‚è¡Œä¸º</strong>åšå‡ºé™åˆ¶ï¼ˆæ¯”å¦‚github pagesï¼Œç”šè‡³ä¸å¯ä»¥pingğŸ˜…ï¼‰ï¼Œå¯ä»¥é€‰æ‹©ä¸€äº›æ¯”è¾ƒå¤§çš„ç½‘ç«™ã€‚</p>
</blockquote>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com returns 282454 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//sjtu.edu.cn returns 69499 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//acm.sjtu.edu.cn/OnlineJudge/ returns 6467 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//chat.deepseek.com/ returns 2024 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//www.bilibili.com/ returns 1824 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//stackoverflow.com/questions returns 6994 bytes</span><br>Total time for concurrency: <span class="hljs-number">0.62</span> seconds<br><span class="hljs-symbol">https:</span><span class="hljs-comment">//github.com returns 282453 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//sjtu.edu.cn returns 69499 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//acm.sjtu.edu.cn/OnlineJudge/ returns 6467 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//chat.deepseek.com/ returns 2023 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//www.bilibili.com/ returns 1886 bytes</span><br><span class="hljs-symbol">https:</span><span class="hljs-comment">//stackoverflow.com/questions returns 6994 bytes</span><br>Total time for no concurrency: <span class="hljs-number">2.71</span> seconds<br></code></pre></td></tr></table></figure>

<h4 id="Example2-Simulation-of-User-I-O"><a href="#Example2-Simulation-of-User-I-O" class="headerlink" title="Example2: Simulation of User I&#x2F;O"></a>Example2: Simulation of User I&#x2F;O</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user_io_simulation</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;Use time.sleep to simulate the wait for user input&quot;&quot;&quot;</span><br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">simulation</span>():<br>    total = <span class="hljs-number">100</span><br>    <span class="hljs-keyword">while</span> total &gt; <span class="hljs-number">0</span>:<br>        total -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> total % <span class="hljs-number">20</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">input</span> = user_io_simulation()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;User enters the input <span class="hljs-subst">&#123;<span class="hljs-built_in">input</span>&#125;</span>&quot;</span>)<br>            total -= <span class="hljs-built_in">input</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Now the total value is <span class="hljs-subst">&#123;total&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done!&quot;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">user_io_simulation_2</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;Simulation with async</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Returns:</span><br><span class="hljs-string">        int: The user input</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">simulation_concurrency</span>():<br>    total = <span class="hljs-number">100</span><br>    tasks = []  <span class="hljs-comment"># List to store tasks</span><br>    <span class="hljs-keyword">while</span> total &gt; <span class="hljs-number">0</span>:<br>        total -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> total % <span class="hljs-number">20</span> == <span class="hljs-number">0</span>:<br>            <span class="hljs-comment"># Create a task for user input simulation</span><br>            task = asyncio.create_task(user_io_simulation_2())<br>            tasks.append(task)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Now the total value is: <span class="hljs-subst">&#123;total&#125;</span>&quot;</span>)<br><br>    <span class="hljs-comment"># Wait for all tasks to complete</span><br>    results = <span class="hljs-keyword">await</span> asyncio.gather(*tasks)<br>    <span class="hljs-keyword">for</span> user_input <span class="hljs-keyword">in</span> results:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;User enters the input: <span class="hljs-subst">&#123;user_input&#125;</span>&quot;</span>)<br>        total -= user_input<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Done!&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">await</span> simulation_concurrency()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Testing simulation for no concurrency&quot;</span>)<br>    start_time = time.time()<br>    simulation()<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Time cost: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Testing simulation for concurrency&quot;</span>)<br>    start_time = time.time()<br>    asyncio.run(main())<br>    end_time = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Time cost: <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.2</span>f&#125;</span> seconds&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>ç¨‹åºçš„è¾“å‡ºï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Testing</span> simulation for no concurrency<br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">99</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">98</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">97</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">96</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">95</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">94</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">93</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">92</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">91</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">90</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">89</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">88</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">87</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">86</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">85</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">84</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">83</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">82</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">81</span><br><span class="hljs-attribute">User</span> enters the input <span class="hljs-number">1</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">79</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">78</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">77</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">76</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">75</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">74</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">73</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">72</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">71</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">70</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">69</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">68</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">67</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">66</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">65</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">64</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">63</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">62</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">61</span><br><span class="hljs-attribute">User</span> enters the input <span class="hljs-number">3</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">57</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">56</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">55</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">54</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">53</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">52</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">51</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">50</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">49</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">48</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">47</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">46</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">45</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">44</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">43</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">42</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">41</span><br><span class="hljs-attribute">User</span> enters the input <span class="hljs-number">4</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">36</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">35</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">34</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">33</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">32</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">31</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">30</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">29</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">28</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">27</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">26</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">25</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">24</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">23</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">22</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">21</span><br><span class="hljs-attribute">User</span> enters the input <span class="hljs-number">4</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">16</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">15</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">14</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">13</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">12</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">11</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">10</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">9</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">8</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">7</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">6</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">5</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">4</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">3</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">2</span><br><span class="hljs-attribute">Now</span> the total value is <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span> enters the input <span class="hljs-number">2</span><br><span class="hljs-attribute">Now</span> the total value is -<span class="hljs-number">2</span><br><span class="hljs-attribute">Done</span>!<br><span class="hljs-attribute">Time</span> cost: <span class="hljs-number">10</span>.<span class="hljs-number">76</span> seconds<br><span class="hljs-attribute">Testing</span> simulation for concurrency<br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">99</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">98</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">97</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">96</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">95</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">94</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">93</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">92</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">91</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">90</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">89</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">88</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">87</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">86</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">85</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">84</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">83</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">82</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">81</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">80</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">79</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">78</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">77</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">76</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">75</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">74</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">73</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">72</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">71</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">70</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">69</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">68</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">67</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">66</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">65</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">64</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">63</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">62</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">61</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">60</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">59</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">58</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">57</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">56</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">55</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">54</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">53</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">52</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">51</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">50</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">49</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">48</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">47</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">46</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">45</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">44</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">43</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">42</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">41</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">40</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">39</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">38</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">37</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">36</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">35</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">34</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">33</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">32</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">31</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">30</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">29</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">28</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">27</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">26</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">25</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">24</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">23</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">22</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">21</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">20</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">19</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">18</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">17</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">16</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">15</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">14</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">13</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">12</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">11</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">10</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">9</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">8</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">7</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">6</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">5</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">4</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">3</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">2</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">1</span><br><span class="hljs-attribute">Now</span> the total value is: <span class="hljs-number">0</span><br><span class="hljs-attribute">User</span> enters the input: <span class="hljs-number">2</span><br><span class="hljs-attribute">User</span> enters the input: <span class="hljs-number">3</span><br><span class="hljs-attribute">User</span> enters the input: <span class="hljs-number">4</span><br><span class="hljs-attribute">User</span> enters the input: <span class="hljs-number">3</span><br><span class="hljs-attribute">User</span> enters the input: <span class="hljs-number">1</span><br><span class="hljs-attribute">Done</span>!<br><span class="hljs-attribute">Time</span> cost: <span class="hljs-number">2</span>.<span class="hljs-number">01</span> seconds<br></code></pre></td></tr></table></figure>

<p>åœ¨<strong>å¼‚æ­¥</strong>çš„ç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·çš„è¾“å‡ºï¼ˆé˜»å¡çš„IOæ“ä½œï¼‰è¢«åŠ å…¥äº†ä¸€ä¸ªtaskåˆ—è¡¨ä¸­ï¼Œåœ¨è¾“å‡ºä¸­ä¹Ÿå¯ä»¥çœ‹è§<strong>ç”¨æˆ·çš„è¾“å‡ºåäºå…¶ä»–ç¨‹åºé€»è¾‘æ‰§è¡Œ</strong>ï¼Œå› æ­¤ç›²ç›®çš„ä½¿ç”¨<strong>å¼‚æ­¥ç¼–ç¨‹</strong>ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä»£ç é€»è¾‘çš„é”™ä¹±ï¼Œå¿…é¡»è¦è°¨æ…ä½¿ç”¨ã€‚</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Project/" class="category-chain-item">Project</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Finished/" class="print-no-link">#Finished</a>
      
        <a href="/tags/Python/" class="print-no-link">#Python</a>
      
        <a href="/tags/Tutorial/" class="print-no-link">#Tutorial</a>
      
        <a href="/tags/GIL/" class="print-no-link">#GIL</a>
      
        <a href="/tags/Threadings/" class="print-no-link">#Threadings</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Python Threadings</div>
      <div>https://xiyuanyang-code.github.io/posts/Python-Threadings/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Xiyuan Yang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>May 1, 2025</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>May 2, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/AINN-Transformer/" title="AINN Transformer">
                        <span class="hidden-mobile">AINN Transformer</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"xiyuanyang-code/xiyuanyang-code.github.io","repo-id":"R_kgDONRhvHQ","category":"Announcements","category-id":"DIC_kwDONRhvHc4ClBnp","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/xiyuanyang-code" target="_blank" rel="nofollow noopener"><span>YXY</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/Siyan-Li" target="_blank" rel="nofollow noopener"><span>LSY</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
