

<!DOCTYPE html>
<html lang="en" >



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/img/YXY.png">
  <link rel="icon" href="/img/YXY.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#c30000">
  <meta name="author" content="Xiyuan Yang">
  <meta name="keywords" content="Code">
  
    <meta name="description" content="In this article, you will learn another core concept in object-oriented programming which are inheritance and polymorphism, including polymorphic public inheritance, virtual functions and ABC.">
<meta property="og:type" content="article">
<meta property="og:title" content="Class-Inheritance">
<meta property="og:url" content="https://xiyuanyang-code.github.io/posts/Class-Inheritance/index.html">
<meta property="og:site_name" content="Xiyuan Yang&#39;s Blog">
<meta property="og:description" content="In this article, you will learn another core concept in object-oriented programming which are inheritance and polymorphism, including polymorphic public inheritance, virtual functions and ABC.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://xiyuanyang-code.github.io/img/cover/inheritance.png">
<meta property="article:published_time" content="2024-12-08T06:02:57.000Z">
<meta property="article:modified_time" content="2025-05-18T16:18:39.658Z">
<meta property="article:author" content="Xiyuan Yang">
<meta property="article:tag" content="tutorial">
<meta property="article:tag" content="Finished">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="OOP">
<meta property="article:tag" content="C++ Primer Plus">
<meta property="article:tag" content="Inheritance">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xiyuanyang-code.github.io/img/cover/inheritance.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Class-Inheritance - Xiyuan Yang&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xiyuanyang-code.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4","placement":"left","visible":"hover","icon":"❡"},"progressbar":{"enable":true,"height_px":3,"color":"red","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":"L7r0uGb0fafbzNvmBADCMH42-gzGzoHsz","app_key":"2Lr1fQ2rjhwRiUrDx0VOQyUm","server_url":null,"path":"window.location.pathname","ignore_local":true},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Xiyuan Yang&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="https://xiyuanyang-code.github.io/posts/Above-All-en/" target="_self">
                <i class="iconfont icon-bookmark-fill"></i>
                <span>Intro</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archive</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Category</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="https://xiyuanyang-code.github.io/resume/" target="_self">
                <i class="iconfont icon-code"></i>
                <span>Resume</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-clipcheck"></i>
                <span>Record</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/Recordings/" target="_self">
                    <i class="iconfont icon-clipcheck"></i>
                    <span>Daily Loggings</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/ReadPaper/" target="_self">
                    <i class="iconfont icon-clipcheck"></i>
                    <span>Reading Papers</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>Else</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/FAQ/" target="_self">
                    <i class="iconfont icon-bug"></i>
                    <span>FAQ</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/links" target="_self">
                    <i class="iconfont icon-link-fill"></i>
                    <span>Links</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/" target="_self">
                    <i class="iconfont icon-tags-fill"></i>
                    <span>Tag</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://xiyuanyang-code.github.io/Blog-word-counting/" target="_self">
                    <i class="iconfont icon-plan"></i>
                    <span>Word Counting</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://xiyuanyang-code.github.io/posts/My-Posts/" target="_self">
                    <i class="iconfont icon-notebook"></i>
                    <span>All Posts</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://github.com/xiyuanyang-code" target="_self">
                    <i class="iconfont icon-github-fill"></i>
                    <span>My Github</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://hexo.fluid-dev.com/" target="_self">
                    <i class="iconfont icon-copyright"></i>
                    <span>About Hexo</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://xiyuanyang-code.github.io/posts/Life-musings/" target="_self">
                    <i class="iconfont icon-brush"></i>
                    <span>Life Musing</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/place.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Class-Inheritance"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Xiyuan Yang
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-12-08 14:02" pubdate>
          December 8, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          9.8k words
        
      </span>
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Code"
        id="heading-ca0dbad92a874b2f69b549293387925e" role="tab" data-toggle="collapse" href="#collapse-ca0dbad92a874b2f69b549293387925e"
        aria-expanded="true"
      >
        Code
        <span class="list-group-count">(29)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-ca0dbad92a874b2f69b549293387925e"
           role="tabpanel" aria-labelledby="heading-ca0dbad92a874b2f69b549293387925e">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/Regular-Expression/" title="Regular-Expression"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Regular-Expression</span>
        </a>
      
    
      
      
        <a href="/posts/Rust-OwnerShip/" title="Rust-OwnerShip"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Rust-OwnerShip</span>
        </a>
      
    
      
      
        <a href="/posts/Automaton-NFA/" title="Automaton NFA"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Automaton NFA</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Architecture Design"
        id="heading-ae64194051878ec826a5a24ebf799d69" role="tab" data-toggle="collapse" href="#collapse-ae64194051878ec826a5a24ebf799d69"
        aria-expanded="false"
      >
        Architecture Design
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-ae64194051878ec826a5a24ebf799d69"
           role="tabpanel" aria-labelledby="heading-ae64194051878ec826a5a24ebf799d69">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/Python-Architecture-Patterns/" title="Python Architecture Patterns"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Architecture Patterns</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Architecture-Patterns-Multi-file-Progarmming/" title="Python Architecture Patterns: Multi-File Programming"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Architecture Patterns: Multi-File Programming</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Cpp"
        id="heading-db4a39bf594c9fbcf318dd39ea19fed3" role="tab" data-toggle="collapse" href="#collapse-db4a39bf594c9fbcf318dd39ea19fed3"
        aria-expanded="true"
      >
        Cpp
        <span class="list-group-count">(11)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-db4a39bf594c9fbcf318dd39ea19fed3"
           role="tabpanel" aria-labelledby="heading-db4a39bf594c9fbcf318dd39ea19fed3">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/C-plus-plus-Primer-Plus-tutorial/" title="C-Plus-Plus-Primer-Plus-Tutorial"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">C-Plus-Plus-Primer-Plus-Tutorial</span>
        </a>
      
    
      
      
        <a href="/posts/Introduction-to-OOP/" title="Introduction-to-OOP"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Introduction-to-OOP</span>
        </a>
      
    
      
      
        <a href="/posts/Dynamic-Memory-and-Classes/" title="Dynamic-Memory-and-Classes"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Dynamic-Memory-and-Classes</span>
        </a>
      
    
      
      
        <a href="/posts/Linked-List-Implementation-Based-on-Structs/" title="Linked-List-Implementation-Based-on-Structs"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Linked-List-Implementation-Based-on-Structs</span>
        </a>
      
    
      
      
        <a href="/posts/Class-Inheritance/" title="Class-Inheritance"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">Class-Inheritance</span>
        </a>
      
    
      
      
        <a href="/posts/Code-Reuse-in-OOP/" title="Code-Reuse-in-OOP"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Code-Reuse-in-OOP</span>
        </a>
      
    
      
      
        <a href="/posts/Exception-Handling-in-C-plus-plus/" title="Exception-Handling-in-C-Plus-Plus"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Exception-Handling-in-C-Plus-Plus</span>
        </a>
      
    
      
      
        <a href="/posts/Pointers-Arrays-and-Functions/" title="Pointers-Arrays-and-Functions"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Pointers-Arrays-and-Functions</span>
        </a>
      
    
      
      
        <a href="/posts/Input-and-Output-in-C-plus-plus/" title="Input-and-Output-in-C-Plus-Plus"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Input-and-Output-in-C-Plus-Plus</span>
        </a>
      
    
      
      
        <a href="/posts/Jotting-References-and-Encapsulation-in-OOP/" title="Jotting-References-and-Encapsulation-in-OOP"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Jotting-References-and-Encapsulation-in-OOP</span>
        </a>
      
    
      
      
        <a href="/posts/Modern-C/" title="Modern C++"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Modern C++</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Full Stack Programming"
        id="heading-ed70836892f4090a9d2e4a24cc30dcda" role="tab" data-toggle="collapse" href="#collapse-ed70836892f4090a9d2e4a24cc30dcda"
        aria-expanded="false"
      >
        Full Stack Programming
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-ed70836892f4090a9d2e4a24cc30dcda"
           role="tabpanel" aria-labelledby="heading-ed70836892f4090a9d2e4a24cc30dcda">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Frontend"
        id="heading-d97ba66b283564339628b71975a6e68d" role="tab" data-toggle="collapse" href="#collapse-d97ba66b283564339628b71975a6e68d"
        aria-expanded="false"
      >
        Frontend
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-d97ba66b283564339628b71975a6e68d"
           role="tabpanel" aria-labelledby="heading-d97ba66b283564339628b71975a6e68d">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/Javascripts-Memo/" title="Javascripts Memo"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Javascripts Memo</span>
        </a>
      
    
      
      
        <a href="/posts/Javascripts-Advanced/" title="Javascripts Advanced"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Javascripts Advanced</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Python"
        id="heading-a7f5f35426b927411fc9231b56382173" role="tab" data-toggle="collapse" href="#collapse-a7f5f35426b927411fc9231b56382173"
        aria-expanded="false"
      >
        Python
        <span class="list-group-count">(11)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-a7f5f35426b927411fc9231b56382173"
           role="tabpanel" aria-labelledby="heading-a7f5f35426b927411fc9231b56382173">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/posts/Python-cheatsheet/" title="Python-Cheatsheet"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python-Cheatsheet</span>
        </a>
      
    
      
      
        <a href="/posts/Python-File-Management/" title="File Management in Python"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">File Management in Python</span>
        </a>
      
    
      
      
        <a href="/posts/Python-numpy-cheatsheet/" title="Python-Numpy-Cheatsheet"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python-Numpy-Cheatsheet</span>
        </a>
      
    
      
      
        <a href="/posts/Python-visualization/" title="Python-Visualization"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python-Visualization</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Threadings/" title="Python Threadings"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Threadings</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Environment-Modules-Tutorial/" title="Python Environment Modules Tutorial"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Environment Modules Tutorial</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Pipe/" title="Python Pipe &amp; Functional Programming"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Pipe &amp; Functional Programming</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Package-Manager/" title="Python Package Manager"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Package Manager</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Advanced-Programming/" title="Python Pythonic"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Pythonic</span>
        </a>
      
    
      
      
        <a href="/posts/Pythonic-Functional-Programming/" title="Pythonic Functional Programming"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Pythonic Functional Programming</span>
        </a>
      
    
      
      
        <a href="/posts/Python-Scraping-Tutorial/" title="Python Scraping Tutorial"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Python Scraping Tutorial</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Class-Inheritance</h1>
            
            
              <div class="markdown-body">
                
                <style>
  html, body, .markdown-body {
    font-family: Georgia, sans, serif;
  }
</style>

<h1 id="C-Primer-Plus-Tutorial-13"><a href="#C-Primer-Plus-Tutorial-13" class="headerlink" title="C++ Primer Plus Tutorial-13"></a>C++ Primer Plus Tutorial-13</h1><h1 id="面向对象编程教程——Section③"><a href="#面向对象编程教程——Section③" class="headerlink" title="面向对象编程教程——Section③"></a>面向对象编程教程——Section③</h1><center><p style="color: red;"><b><font size=6.5>Chapter 13 Class Inheritance</font></b></p></center>

<center><p style="color: red;"><b><font size=6.5>类的继承</font></b></p></center>

<p>【写在前面的话】</p>
<p><a href="https://xiyuanyang-code.github.io/posts/C-plus-plus-Primer-Plus-tutorial/">C++ Primer Plus Tutorial</a></p>
<p><a href="https://xiyuanyang-code.github.io/tags/OOP/">系列文章</a></p>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>在本文中，你将学到面向对象编程中的又一个核心思想：继承与多态。本文从一个基本的基类讲起并延伸到派生类的定义和基本使用，探讨派生类和基类的特殊关系。接下来本文深入继承的原理，介绍在多态公有继承中的<strong>is-a</strong>关系和虚函数，已经动态联编和静态联编的基本知识。接着本文介绍了抽象基类的使用提高效率以及在派生类中使用动态内存分配的注意事项。最后本文对OOP的基本精神——封装、继承与多态和相关基础知识做了梳理。</p>
<blockquote>
<p>In this article, you will learn another core concept in object-oriented programming: inheritance and polymorphism. The article begins with a basic base class and extends to the definition and basic usage of derived classes, exploring the special relationship between derived and base classes. Next, the article delves into the principles of inheritance, introducing the <strong>is-a</strong> relationship in polymorphic public inheritance, virtual functions, and the basics of dynamic and static binding. Then, the article discusses the use of abstract base classes to improve efficiency, as well as considerations for using dynamic memory allocation in derived classes. Finally, the article summarizes the fundamental principles of OOP—encapsulation, inheritance, and polymorphism—along with related foundational knowledge.</p>
</blockquote>
<h2 id="Table-of-Contents"><a href="#Table-of-Contents" class="headerlink" title="Table of Contents"></a>Table of Contents</h2><ul>
<li>基类函数和派生类函数的简单示例<ul>
<li>派生类的构造函数</li>
<li>使用派生类</li>
<li>派生类和基类的特殊关系</li>
</ul>
</li>
<li>继承<ul>
<li>多态公有继承</li>
<li>虚函数</li>
<li>静态联编和动态联编</li>
</ul>
</li>
<li>抽象基类</li>
<li>继承和动态内存分配</li>
<li>对面向对象基本知识的总结</li>
</ul>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>在程序设计中，代码的重用是非常重要的，这一点在面向对象编程也不例外。一种最简单的“代码重用”是最简单的<code>Ctrl-C,Ctrl-V</code>程序员，手动修改代码实现重用（乐）。那么，我们如何在不修改代码的基础上实现代码（对于OOP而言，主要是类和对象）的重用呢？这便是<strong>类的继承</strong>：从已有的类（基类）将特征和方法继承给一个新的类（派生类）。同时，类的继承也保证了安全性，派生类可以提供新特性，甚至不需要访问源代码就可以派生出类，实现<strong>数据的封装</strong>。（这不正是OOP的核心和精髓吗）</p>
<p>接下来的一章，让我们走进类继承的世界。</p>
<h2 id="Example-Base-class-and-derived-class"><a href="#Example-Base-class-and-derived-class" class="headerlink" title="Example: Base class and derived class"></a>Example: Base class and derived class</h2><p>文章首先给出一个比较简单的基类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// tabtenn0.h -- a table-tennis base class</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> TABTENN0_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TABTENN0_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> std::string;<br><span class="hljs-comment">// simple base class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TableTennisPlayer</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    string firstname;<br>    string lastname;<br>    <span class="hljs-type">bool</span> hasTable;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">TableTennisPlayer</span> (<span class="hljs-type">const</span> string &amp; fn = <span class="hljs-string">&quot;none&quot;</span>,<span class="hljs-type">const</span> string &amp; ln = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">bool</span> ht = <span class="hljs-literal">false</span>);<br>    <span class="hljs-comment">//默认构造函数</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-comment">//输出会员的姓名</span><br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">HasTable</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> hasTable; &#125;;<br>    <span class="hljs-comment">//判断会员是否有球桌</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetTable</span><span class="hljs-params">(<span class="hljs-type">bool</span> v)</span> </span>&#123; hasTable = v; &#125;;<br>    <span class="hljs-comment">//重设球桌状态</span><br>&#125;;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//tabtenn0.cpp -- simple base-class methods</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;tabtenn0.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br>TableTennisPlayer::<span class="hljs-built_in">TableTennisPlayer</span> (<span class="hljs-type">const</span> string &amp; fn, <br>    <span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <span class="hljs-built_in">firstname</span>(fn),<span class="hljs-built_in">lastname</span>(ln), <span class="hljs-built_in">hasTable</span>(ht) &#123;&#125;<br>    <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">TableTennisPlayer::Name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    std::cout &lt;&lt; lastname &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; firstname;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// usett0.cpp -- using a base class</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;tabtenn0.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">( <span class="hljs-type">void</span> )</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">using</span> std::cout;<br>    <span class="hljs-function">TableTennisPlayer <span class="hljs-title">player1</span><span class="hljs-params">(<span class="hljs-string">&quot;Chuck&quot;</span>, <span class="hljs-string">&quot;Blizzard&quot;</span>, <span class="hljs-literal">true</span>)</span></span>;<br>    <span class="hljs-function">TableTennisPlayer <span class="hljs-title">player2</span><span class="hljs-params">(<span class="hljs-string">&quot;Tara&quot;</span>, <span class="hljs-string">&quot;Boomdea&quot;</span>, <span class="hljs-literal">false</span>)</span></span>;<br>    player<span class="hljs-number">1.</span><span class="hljs-built_in">Name</span>();<br>    <span class="hljs-keyword">if</span> (player<span class="hljs-number">1.</span><span class="hljs-built_in">HasTable</span>())<br>        cout &lt;&lt; <span class="hljs-string">&quot;: has a table.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;: hasn&#x27;t a table.\n&quot;</span>;<br>    player<span class="hljs-number">2.</span><span class="hljs-built_in">Name</span>();<br>    <span class="hljs-keyword">if</span> (player<span class="hljs-number">2.</span><span class="hljs-built_in">HasTable</span>())<br>        cout &lt;&lt; <span class="hljs-string">&quot;: has a table&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;: hasn&#x27;t a table.\n&quot;</span>;<br>    <span class="hljs-comment">// std::cin.get();</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>现在，我要在这个类的基础之上派生出一个新的类，来记录乒乓球运动员在比赛中的得分。</p>
<p>先来看写好的头文件，再来逐行解析：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// tabtenn1.h -- a table-tennis base class</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> TABTENN1_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> TABTENN1_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> std::string;<br><span class="hljs-comment">// simple base class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TableTennisPlayer</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    string firstname;<br>    string lastname;<br>    <span class="hljs-type">bool</span> hasTable;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">TableTennisPlayer</span> (<span class="hljs-type">const</span> string &amp; fn = <span class="hljs-string">&quot;none&quot;</span>,<span class="hljs-type">const</span> string &amp; ln = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">bool</span> ht = <span class="hljs-literal">false</span>);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">HasTable</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> hasTable; &#125;;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetTable</span><span class="hljs-params">(<span class="hljs-type">bool</span> v)</span> </span>&#123; hasTable = v; &#125;;<br>&#125;;<br><br><span class="hljs-comment">// simple derived class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RatedPlayer</span> : <span class="hljs-keyword">public</span> TableTennisPlayer<br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> rating;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">RatedPlayer</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>, <span class="hljs-type">const</span> string &amp; fn = <span class="hljs-string">&quot;none&quot;</span>,<br>                 <span class="hljs-type">const</span> string &amp; ln = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">bool</span> ht = <span class="hljs-literal">false</span>);<br>    <span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp);<br>    <span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title">Rating</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> rating; &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetRating</span> <span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r)</span> </span>&#123;rating = r;&#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<p>很容易的看出，<code>RatedPlayer</code>是从<code>TableTennisPlayer</code>派生出来的派生类。最基本的语法定义如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RatedPlayer</span> : <span class="hljs-keyword">public</span> TableTennisPlayer<br>&#123;<br><span class="hljs-keyword">private</span>:<br><span class="hljs-comment">//your Declaration here</span><br><span class="hljs-keyword">public</span>:<br><span class="hljs-comment">//your Declaration here</span><br>&#125;;<br><br></code></pre></td></tr></table></figure>

<p>冒号指出 <code>RatedPlayer</code> 类的基类是 <code>TableTennisplayer</code> 类。上述特殊的声明头表明 <code>TableTennisPlayer</code> 是一个<strong>公有基类</strong>，这被称为<strong>公有派生</strong>。<strong>派生类对象包含基类对象</strong>。使用公有派生，<strong>基类的公有成员将成为派生类的公有成员</strong>；<strong>基类的私有部分也将成为派生类的一部分</strong>，但只能通过基类的公有和保护方法访问（稍后将介绍保护成员）。</p>
<p><code>Ratedplayer</code>对象将具有以下特征：</p>
<ul>
<li>派生类对象存储了基类的数据成员（派生类继承了基类的实现）；</li>
<li>派生类对象可以使用基类的方法（派生类继承了基类的接口）。</li>
</ul>
<blockquote>
<p>派生类就像基类的“儿子”，子承父业，可以直接继承父亲的所有遗产。</p>
</blockquote>
<p>这是<strong>继承</strong>的部分，同时，派生类也可以实现自己的新方法和新成员，这也在3~6行的代码处定义。</p>
<ul>
<li>派生类<strong>需要</strong>自己的构造函数（<strong>这很重要！</strong>）</li>
<li>派生类可以添加额外的数据方法和数据成员。</li>
</ul>
<h3 id="派生类的构造函数：访问权限的考虑"><a href="#派生类的构造函数：访问权限的考虑" class="headerlink" title="派生类的构造函数：访问权限的考虑"></a>派生类的构造函数：访问权限的考虑</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">RatedPlayer</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>, <span class="hljs-type">const</span> string &amp; fn = <span class="hljs-string">&quot;none&quot;</span>,<br>             <span class="hljs-type">const</span> string &amp; ln = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">bool</span> ht = <span class="hljs-literal">false</span>);<br><span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp);<br></code></pre></td></tr></table></figure>

<p>上文代码是派生类中实现的两个构造函数，可以看出，构造函数要同时定义<strong>原有基类的数据成员和新添加的数据成员</strong>（第一个构造函数）。当然，偷懒一点也是可以的，可以在构造函数中使用到<strong>基类的对象</strong>（第二个构造函数）。</p>
<p>但是，构造函数的设计并不是像想象的那么简单。前文的<code>Introduction</code>讲过，派生类甚至可以在不访问基类的情况下实现继承。实际上，<strong>派生类不可以直接访问基类的私有成员，而必须通过基类定义的方法进行访问（和外部的函数一样，只能通过接口进行访问）</strong>，换句话来说，<strong>派生类构造函数必须使用基类构造函数</strong>。</p>
<h4 id="第一种构造函数"><a href="#第一种构造函数" class="headerlink" title="第一种构造函数"></a>第一种构造函数</h4><p>这点就显得非常矛盾了，因为从上文第一个构造函数的视角看过去，我们貌似<strong>给派生类的每一个私有成员提供了数据，貌似可以直接访问所有的私有成员，包括基类和派生类</strong>。实际上，并不是这样，下面我们来详细解释这一点。</p>
<p>我们更进一步，给出第一个构造函数的声明和定义：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//函数声明</span><br><span class="hljs-built_in">RatedPlayer</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>, <span class="hljs-type">const</span> string &amp; fn = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">const</span> string &amp; ln = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">bool</span> ht = <span class="hljs-literal">false</span>);<br><br><span class="hljs-comment">//函数定义</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> string &amp; fn,<span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <span class="hljs-built_in">TableTennisPlayer</span>(fn, ln, ht)<br>&#123;<br>    rating = r;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在创建派生类对象时，程序首先会创建<strong>基类对象</strong>。因此，在使用派生类对象的构造函数时，对应的基类对象已经存在。</p>
<blockquote>
<p>这很好理解，儿子出生之前，爸爸肯定得出生。</p>
</blockquote>
<p>理解了这一点后，我们再来看函数的定义，我们会发现很独特的一行，<code>TableTennisPlayer(fn, ln, ht)</code>。这行代码叫<strong>成员初始化列表</strong>，是可执行的代码，用来调用基类<code>TableTennisPlayer</code>的构造函数。<code>fn, ln, ht</code>作为三个形式参数，接受实参并将其本身传递给<code>TableTennisPlayer</code>构造函数的形式参数，后者将创建一个<strong>嵌套的基类对象</strong>（先创建爸爸），接着，进入派生类函数的函数体，完成对派生类对象的创建。（再创建儿子）</p>
<p>如果省略了成员初始化列表，那么程序会调用<strong>默认的构造函数</strong>创建一个基类对象，而无法使用显式的构造函数，程序就无法读取到我们希望赋给对象的数据。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//没有成员初始化列表的情况</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> string &amp; fn,<span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <br>&#123;<br>    rating = r;<br>&#125;<br><br><span class="hljs-comment">//与下面的代码等效</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> string &amp; fn,<span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <br><span class="hljs-built_in">TableTennisPlayer</span>()<br><span class="hljs-comment">//使用无参数的默认构造函数</span><br>&#123;<br>    rating = r;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="第二种构造函数"><a href="#第二种构造函数" class="headerlink" title="第二种构造函数"></a>第二种构造函数</h4><p>接下来，我们来看第二种更加简洁的构造函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//函数声明</span><br><span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp);<br><br><span class="hljs-comment">//函数定义</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp)<br>    : <span class="hljs-built_in">TableTennisPlayer</span>(tp)<br>&#123;<br>        rating=r;<br>&#125;<br><br><span class="hljs-comment">//函数定义的等价形式</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp)<br>    : <span class="hljs-built_in">TableTennisPlayer</span>(tp), <span class="hljs-built_in">rating</span>(r)<br>&#123;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>来看这里的初始化成员列表，传入的参数是一个<code>const TableTennisPlayer &amp;</code>类型，因此，系统会调用默认的<strong>复制构造函数</strong>（这是个很有趣的问题，我们在<a href="https://xiyuanyang-code.github.io/posts/Dynamic-Memory-and-Classes/">第十二章</a>的时候重点讨论了，这里使用默认的复制构造函数是不会产生任何问题的）。</p>
<p>当然，我们也可以对<strong>派生类成员使用初始化列表</strong>，在这种情况下，应该使用成员名而不是类名。</p>
<blockquote>
<p>释放对象的顺序与创建对象的顺序相反，即首先执行派生类的析构函数，然后自动调用基类的析构函数。  </p>
</blockquote>
<div class="note note-success">
            <p><strong>小总结</strong>： 创建派生类对象时，程序首先<strong>调用基类构造函数</strong>，然后再<strong>调用派生类构造函数</strong>。基类构造函数负责初始化继承的数据成员；派生类构造函数主要用于初始化新增的数据成员。派生类的构造函数总是调用一个基类构造函数。可以使用初始化器列表语法指明要使用的基类构造函数，否则将使用默认的基类构造函数。派生类对象过期时，程序将首先调用派生类析构函数，然后再调用基类析构函数。</p>
          </div>

<p>现在，我们可以给出派生类的全部函数定义：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//tabtenn1.cpp -- simple base-class methods</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;tabtenn1.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br>TableTennisPlayer::<span class="hljs-built_in">TableTennisPlayer</span> (<span class="hljs-type">const</span> string &amp; fn, <br>    <span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <span class="hljs-built_in">firstname</span>(fn),<span class="hljs-built_in">lastname</span>(ln), <span class="hljs-built_in">hasTable</span>(ht) &#123;&#125;<br>    <br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">TableTennisPlayer::Name</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    std::cout &lt;&lt; lastname &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; firstname;<br>&#125;<br><br><span class="hljs-comment">// RatedPlayer methods</span><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> string &amp; fn,<br>    <span class="hljs-type">const</span> string &amp; ln, <span class="hljs-type">bool</span> ht) : <span class="hljs-built_in">TableTennisPlayer</span>(fn, ln, ht)<br>&#123;<br>    rating = r;<br>&#125;<br><br>RatedPlayer::<span class="hljs-built_in">RatedPlayer</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> r, <span class="hljs-type">const</span> TableTennisPlayer &amp; tp)<br>    : <span class="hljs-built_in">TableTennisPlayer</span>(tp), <span class="hljs-built_in">rating</span>(r)<br>&#123;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="使用派生类"><a href="#使用派生类" class="headerlink" title="使用派生类"></a>使用派生类</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// usett1.cpp -- using base class and derived class</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;tabtenn1.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span> <span class="hljs-params">( <span class="hljs-type">void</span> )</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">using</span> std::cout;<br>    <span class="hljs-keyword">using</span> std::endl;<br>    <span class="hljs-function">TableTennisPlayer <span class="hljs-title">player1</span><span class="hljs-params">(<span class="hljs-string">&quot;Tara&quot;</span>, <span class="hljs-string">&quot;Boomdea&quot;</span>, <span class="hljs-literal">false</span>)</span></span>;<br>    <span class="hljs-function">RatedPlayer <span class="hljs-title">rplayer1</span><span class="hljs-params">(<span class="hljs-number">1140</span>, <span class="hljs-string">&quot;Mallory&quot;</span>, <span class="hljs-string">&quot;Duck&quot;</span>, <span class="hljs-literal">true</span>)</span></span>;<br>    rplayer<span class="hljs-number">1.</span><span class="hljs-built_in">Name</span>();          <span class="hljs-comment">// derived object uses base method</span><br>    <span class="hljs-keyword">if</span> (rplayer<span class="hljs-number">1.</span><span class="hljs-built_in">HasTable</span>())<br>        cout &lt;&lt; <span class="hljs-string">&quot;: has a table.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;: hasn&#x27;t a table.\n&quot;</span>;<br>    player<span class="hljs-number">1.</span><span class="hljs-built_in">Name</span>();           <span class="hljs-comment">// base object uses base method</span><br>    <span class="hljs-keyword">if</span> (player<span class="hljs-number">1.</span><span class="hljs-built_in">HasTable</span>())<br>        cout &lt;&lt; <span class="hljs-string">&quot;: has a table&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;: hasn&#x27;t a table.\n&quot;</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Name: &quot;</span>;<br>    rplayer<span class="hljs-number">1.</span><span class="hljs-built_in">Name</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;; Rating: &quot;</span> &lt;&lt; rplayer<span class="hljs-number">1.</span><span class="hljs-built_in">Rating</span>() &lt;&lt; endl;<br><span class="hljs-comment">// initialize RatedPlayer using TableTennisPlayer object</span><br>    <span class="hljs-function">RatedPlayer <span class="hljs-title">rplayer2</span><span class="hljs-params">(<span class="hljs-number">1212</span>, player1)</span></span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Name: &quot;</span>;<br>    rplayer<span class="hljs-number">2.</span><span class="hljs-built_in">Name</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;; Rating: &quot;</span> &lt;&lt; rplayer<span class="hljs-number">2.</span><span class="hljs-built_in">Rating</span>() &lt;&lt; endl;<br>    <span class="hljs-comment">// std::cin.get();</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h3 id="派生类和基类的特殊关系"><a href="#派生类和基类的特殊关系" class="headerlink" title="派生类和基类的特殊关系"></a>派生类和基类的特殊关系</h3><p>用形象的话说，派生类是儿子，继承自基类（爸爸）的方法和数据成员。但是，基类又有自己的“隐私”，派生类是能通过公共接口实现对基类的访问，即无法直接访问其私有成员。</p>
<blockquote>
<p>派生类相当于一种<strong>在定义和结构上</strong>获得“权限”的类，权限在于可以直接继承基类所定义好的成员和方法（在定义层面的<strong>继承</strong>），但是<strong>在操作上</strong>，派生类并没有从基类处获得任何特权，不能访问的还是不能访问。</p>
</blockquote>
<p>从这条出发，我们可以归纳派生类和基类之间的特殊关系：</p>
<ul>
<li>派生类对象可以使用基类的方法，条件是<strong>方法不是私有的</strong>。</li>
<li><strong>基类指针可以在不进行显示转换的情况下指向派生类对象。</strong></li>
<li><strong>基类引用可以在不进行显示转换的情况下引用派生类对象。</strong></li>
</ul>
<blockquote>
<p>二、三两条非常的重要，<strong>指针和引用类型的兼容性</strong>确保了其可以在基类和派生类之间反复横跳，更加的灵活。（同时也更加的复杂和危险）</p>
</blockquote>
<h4 id="基类指针可以在不进行显示转换的情况下指向派生类对象"><a href="#基类指针可以在不进行显示转换的情况下指向派生类对象" class="headerlink" title="基类指针可以在不进行显示转换的情况下指向派生类对象"></a>基类指针可以在不进行显示转换的情况下指向派生类对象</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>&#123; cout &lt;&lt; <span class="hljs-string">&quot;Base class&quot;</span> &lt;&lt; endl; &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123; cout &lt;&lt; <span class="hljs-string">&quot;Derived class&quot;</span> &lt;&lt; endl; &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    Derived d;<br>    Base* basePtr = &amp;d; <span class="hljs-comment">// 基类指针指向派生类对象</span><br>    basePtr-&gt;<span class="hljs-built_in">display</span>(); <span class="hljs-comment">// 输出: Derived class (多态行为)</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="基类引用可以在不进行显示转换的情况下引用派生类对象。"><a href="#基类引用可以在不进行显示转换的情况下引用派生类对象。" class="headerlink" title="基类引用可以在不进行显示转换的情况下引用派生类对象。"></a>基类引用可以在不进行显示转换的情况下引用派生类对象。</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>&#123; cout &lt;&lt; <span class="hljs-string">&quot;Base class&quot;</span> &lt;&lt; endl; &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123; cout &lt;&lt; <span class="hljs-string">&quot;Derived class&quot;</span> &lt;&lt; endl; &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    Derived d;<br>    Base&amp; baseRef = d; <span class="hljs-comment">// 基类引用绑定到派生类对象</span><br>    baseRef.<span class="hljs-built_in">display</span>(); <span class="hljs-comment">// 输出: Derived class (多态行为)</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意关键词<code>virtual</code>，之后会讲到，否则会发生静态绑定现象。</p>
</blockquote>
<ul>
<li>基类指针和引用只能调用基类方法，而不可以调用派生类的方法。<ul>
<li>因为派生类允许添加新的数据成员，如果允许调用会产生很多奇怪的问题。</li>
</ul>
</li>
<li>基类指针和应用可以指向派生类的对象<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/goodgoodstudy___/article/details/124905482">这篇讲的很清楚</a></li>
<li>这里涉及到一些有关虚函数的知识点，暂时先跳过。</li>
</ul>
</li>
<li><strong>基类对象也可以被派生类对象初始化（或赋值）</strong></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">RatedPlayer <span class="hljs-title">player1</span><span class="hljs-params">(<span class="hljs-number">1840</span>,<span class="hljs-string">&quot;o1&quot;</span>,<span class="hljs-string">&quot;Loaf&quot;</span>,<span class="hljs-literal">true</span>)</span></span>;<br><span class="hljs-function">TableTennisPlayer <span class="hljs-title">player2</span><span class="hljs-params">(player1)</span></span>;    <span class="hljs-comment">//VALID</span><br></code></pre></td></tr></table></figure>

<p>可以用<strong>引用兼容性</strong>的属性来解释这个问题，调用基类的构造函数时不存在匹配的构造函数，故会调用隐式复制构造函数<code>TableTennisPlayer(const TableTennisPlayer&amp;)</code>，形参是<strong>对基类的引用</strong>，<strong>可以在不进行显式转换的</strong>情况下引用派生类对象<code>player1</code>。因此，复制构造函数将嵌套在<code>player1</code>基类中的<code>TableTennisPlayer</code>赋值给了<code>player2</code>。</p>
<h2 id="Inheritance"><a href="#Inheritance" class="headerlink" title="Inheritance"></a>Inheritance</h2><p>派生类和基类的特殊关系在本质上基于C++继承的底层模型。C++有常见的三种继承方式：</p>
<ul>
<li><p>公有继承（<strong>is-a关系</strong>）</p>
<ul>
<li>派生类也是一个基类对象，可以执行基类对象执行的任何操作。</li>
<li><strong>is-a：is a kind of</strong>（往往是抽象与具象的关系）</li>
</ul>
<blockquote>
<p>如果一个派生类选择以<strong>公有继承</strong>的方式，那么应该可以被改写成<strong>XX is a kind of XXX</strong>的形式。例如，香蕉类公有继承水果类（香蕉类可以使用水果类的所有数据和方法，同时香蕉也可以定义自己的数据成员和方法），可以说Banana is a kind of fruit.</p>
</blockquote>
<blockquote>
<p>除了<strong>is a</strong>还有什么关系？有很多，比如<strong>has-a, is-like-a, is-implemented-as-a, uses-a</strong>等等关系，不过，这些都不适合使用公有继承的方式实现。</p>
</blockquote>
</li>
<li><p>保护继承</p>
</li>
<li><p>私有继承</p>
</li>
</ul>
<h3 id="多态公有继承"><a href="#多态公有继承" class="headerlink" title="多态公有继承"></a>多态公有继承</h3><p>在传统的继承关系中，派生类可以使用基类的成员函数（只要他不是私有成员）。但有时，派生类希望个性化地修改基类成员函数的方法来实现个性化的目的，因此有必要对基类成员函数进行修改，而非<strong>完全实现</strong>。这种思想被称作<strong>多态</strong>，这种继承方式也被称作多态公有继承。</p>
<h4 id="例子：Brass-Plus类和Brass类"><a href="#例子：Brass-Plus类和Brass类" class="headerlink" title="例子：Brass Plus类和Brass类"></a>例子：<code>Brass Plus类</code>和<code>Brass类</code></h4><p>书上给出了另一个有关银行的例子，有关类的实现原理请自行阅读。</p>
<blockquote>
<p>现在来看另一个例子。由于 Webtown 俱乐部的工作经历，您成了 Pontoon 银行的首席程序员。银行要求您完成的第一项工作是开发两个类。一个类用于表示基本支票账户—Brass Account，另一个类用于表示代表 Brass Plus 支票账户，它添加了透支保护特性。也就是说，如果用户签出一张超出其存款余额的支票——但是超出的数额并不是很大，银行将支付这张支票，对超出的部分收取额外的费用，并追加罚款。可以根据要保存的数据以及允许执行的操作来确定这两种账户的特征。</p>
<p>下面是用于 Brass Account 支票账户的信息：</p>
<ul>
<li>客户姓名；</li>
<li>账号；</li>
<li>当前结余。</li>
</ul>
<p>下面是可以执行的操作：</p>
<ul>
<li>创建账户；</li>
<li>存款；</li>
<li>取款；</li>
<li>显示账户信息。</li>
</ul>
<p>Pontoon 银行希望 Brass Plus 支票账户包含 Brass Account 的所有信息及如下信息：</p>
<ul>
<li>透支上限；</li>
<li>透支贷款利率；</li>
<li>当前的透支总额。</li>
</ul>
<p>不需要新增操作，但有两种操作的实现不同：</p>
<ul>
<li>对于取款操作，必须考虑透支保护；</li>
<li>显示操作必须显示 Brass Plus 账户的其他信息。</li>
</ul>
<p>假设将第一个类命名为 Brass，第二个类为 BrassPlus。应从 Brass 公有派生出 BrassPlus 吗？要回答这个问题，必须先回答另一个问题： BrassPlus 类是否满足 is-a 条件？当然满足。对于 Brass 对象是正确的事情，对于 BrassPlus 对象也是正确的。它们都将保存客户姓名、账号以及结余。使用这两个类都可以存款、取款和显示账户信息。请注意， is-a 关系通常是不可逆的。也就是说，水果不是香蕉；同样， Brass 对象不具备 BrassPlus 对象的所有功能。</p>
</blockquote>
<p>我们直接来看代码，以下是有关两个类实现的头文件声明：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// brass.h  -- bank account classes</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> BRASS_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BRASS_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-comment">// Brass Account Class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Brass</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    std::string fullName;<br>    <span class="hljs-type">long</span> acctNum;<br>    <span class="hljs-type">double</span> balance;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Brass</span>(<span class="hljs-type">const</span> std::string &amp; s = <span class="hljs-string">&quot;Nullbody&quot;</span>, <span class="hljs-type">long</span> an = <span class="hljs-number">-1</span>,<br>                <span class="hljs-type">double</span> bal = <span class="hljs-number">0.0</span>);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Deposit</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Balance</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Brass</span>() &#123;&#125;<br>&#125;;<br><br><span class="hljs-comment">//Brass Plus Account Class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BrassPlus</span> : <span class="hljs-keyword">public</span> Brass<br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">double</span> maxLoan;<br>    <span class="hljs-type">double</span> rate;<br>    <span class="hljs-type">double</span> owesBank;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> std::string &amp; s = <span class="hljs-string">&quot;Nullbody&quot;</span>, <span class="hljs-type">long</span> an = <span class="hljs-number">-1</span>,<br>            <span class="hljs-type">double</span> bal = <span class="hljs-number">0.0</span>, <span class="hljs-type">double</span> ml = <span class="hljs-number">500</span>,<br>            <span class="hljs-type">double</span> r = <span class="hljs-number">0.11125</span>);<br>    <span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> Brass &amp; ba, <span class="hljs-type">double</span> ml = <span class="hljs-number">500</span>, <br>		                        <span class="hljs-type">double</span> r = <span class="hljs-number">0.11125</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">ViewAcct</span><span class="hljs-params">()</span><span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetMax</span><span class="hljs-params">(<span class="hljs-type">double</span> m)</span> </span>&#123; maxLoan = m; &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetRate</span><span class="hljs-params">(<span class="hljs-type">double</span> r)</span> </span>&#123; rate = r; &#125;;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetOwes</span><span class="hljs-params">()</span> </span>&#123; owesBank = <span class="hljs-number">0</span>; &#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure>

<p>我们发现有以下几点：</p>
<ul>
<li><code>BrassPlus</code>类和<code>Brass</code>类都定义了同名函数<code>Withdraw()</code>和<code>Viewacct()</code>。<ul>
<li>编译器将根据对象的类型自动选择使用哪个类定义中的函数。</li>
</ul>
</li>
<li>出现了新关键词<code>virtual</code><strong>（虚方法）</strong></li>
</ul>
<h4 id="虚函数"><a href="#虚函数" class="headerlink" title="虚函数"></a>虚函数</h4><p>函数<code>Withdraw()</code>和<code>Viewacct()</code>不同于一般的方法 ，在基类和派生类中都有自己的定义（而且定义一般是不同的），这些函数在面向对象编程中被称为<strong>虚函数</strong>。</p>
<div class="note note-info">
            <p>虚函数是指一个<strong>在基类中声明并可以在派生类中重写的成员函数</strong>。虚函数的主要作用是实现<strong>运行时多态</strong>（Runtime Polymorphism），即程序在执行过程中根据对象的实际类型调用相应的函数版本，而不是<strong>根据指针或引用的类型来决定</strong>。</p>
          </div>

<p>下面我们来详细解释一下这个定义，请看如下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Base class show&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Derived class show&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    Base* basePtr;  <span class="hljs-comment">// 基类指针</span><br>    Derived derivedObj;  <span class="hljs-comment">// 派生类对象</span><br>    <br>    basePtr = &amp;derivedObj;  <span class="hljs-comment">// 基类指针指向派生类对象</span><br>    <br>    <span class="hljs-comment">// 虚函数的调用</span><br>    basePtr-&gt;<span class="hljs-built_in">show</span>();  <span class="hljs-comment">// 运行时会调用派生类的 show()，输出: Derived class show</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在这里，指针<code>basePtr</code>的<strong>定义类型</strong>是Base（基类），但是指向一个派生类的对象（上文提到过这种行为是合法的）。那么在下一行调用<code>show</code>函数的时候是应该<strong>优先考虑指针本身的类型</strong>，还是考虑<strong>指针指向对象的类型</strong>呢？因此，C++引入了关键词<code>virtual</code>来声明一个虚函数，对于虚函数而言，在调用时会<strong>根据对象的实际类型来调用相对应的同名函数</strong>，比如在上文由于baseptr指向的<strong>实际对象</strong>是一个派生类的对象，所以会<strong>调用派生类的函数</strong>。</p>
<blockquote>
<p>如果不加virtual关键词，编译器会报错（这个需要更加深入的知识了）</p>
</blockquote>
<p>有意思的是，基类<code>Brass</code>的虚构函数同样使用了<code>virtual</code>关键词来定义，这样做是为了确保释放派生对象时，按照正确的顺序调用析构函数。（这形成了一种惯例，后文会再提到）</p>
<p>接下来，我们来看两个类的具体定义。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// brass.cpp -- bank account class methods</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;brass.h&quot;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::endl;<br><span class="hljs-keyword">using</span> std::string;<br><br><span class="hljs-comment">// formatting stuff</span><br><span class="hljs-keyword">typedef</span> std::ios_base::fmtflags format;<br><span class="hljs-keyword">typedef</span> std::streamsize precis;<br><span class="hljs-function">format <span class="hljs-title">setFormat</span><span class="hljs-params">()</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">restore</span><span class="hljs-params">(format f, precis p)</span></span>;<br><br><span class="hljs-comment">// Brass methods</span><br><br>Brass::<span class="hljs-built_in">Brass</span>(<span class="hljs-type">const</span> string &amp; s, <span class="hljs-type">long</span> an, <span class="hljs-type">double</span> bal)<br>&#123;<br>    fullName = s;<br>    acctNum = an;<br>    balance = bal;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Brass::Deposit</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (amt &lt; <span class="hljs-number">0</span>)<br>        cout &lt;&lt; <span class="hljs-string">&quot;Negative deposit not allowed; &quot;</span><br>             &lt;&lt; <span class="hljs-string">&quot;deposit is cancelled.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        balance += amt;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Brass::Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// set up ###.## format</span><br>    format initialState = <span class="hljs-built_in">setFormat</span>();<br>    precis prec = cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-keyword">if</span> (amt &lt; <span class="hljs-number">0</span>)<br>        cout &lt;&lt; <span class="hljs-string">&quot;Withdrawal amount must be positive; &quot;</span><br><br>             &lt;&lt; <span class="hljs-string">&quot;withdrawal canceled.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (amt &lt;= balance)<br>        balance -= amt;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Withdrawal amount of $&quot;</span> &lt;&lt; amt<br>             &lt;&lt; <span class="hljs-string">&quot; exceeds your balance.\n&quot;</span><br>             &lt;&lt; <span class="hljs-string">&quot;Withdrawal canceled.\n&quot;</span>;<br>    <span class="hljs-built_in">restore</span>(initialState, prec);<br>&#125;<br><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Brass::Balance</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> balance;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Brass::ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>     <span class="hljs-comment">// set up ###.## format</span><br>    format initialState = <span class="hljs-built_in">setFormat</span>();<br>    precis prec = cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">2</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;Client: &quot;</span> &lt;&lt; fullName &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Account Number: &quot;</span> &lt;&lt; acctNum &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Balance: $&quot;</span> &lt;&lt; balance &lt;&lt; endl;<br>    <span class="hljs-built_in">restore</span>(initialState, prec); <span class="hljs-comment">// Restore original format</span><br>&#125;<br><br><span class="hljs-comment">// BrassPlus Methods</span><br>BrassPlus::<span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> string &amp; s, <span class="hljs-type">long</span> an, <span class="hljs-type">double</span> bal,<br>           <span class="hljs-type">double</span> ml, <span class="hljs-type">double</span> r) : <span class="hljs-built_in">Brass</span>(s, an, bal)<br>&#123;<br>    maxLoan = ml;<br>    owesBank = <span class="hljs-number">0.0</span>;<br>    rate = r;<br>&#125;<br><br>BrassPlus::<span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> Brass &amp; ba, <span class="hljs-type">double</span> ml, <span class="hljs-type">double</span> r)<br>           : <span class="hljs-built_in">Brass</span>(ba)   <span class="hljs-comment">// uses implicit copy constructor</span><br>&#123;<br>    maxLoan = ml;<br>    owesBank = <span class="hljs-number">0.0</span>;<br>    rate = r;<br>&#125;<br><br><span class="hljs-comment">// redefine how ViewAcct() works</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BrassPlus::ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// set up ###.## format</span><br>    format initialState = <span class="hljs-built_in">setFormat</span>();<br>    precis prec = cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">2</span>);<br><br>    Brass::<span class="hljs-built_in">ViewAcct</span>();   <span class="hljs-comment">// display base portion</span><br>    <span class="hljs-comment">//注意：这里必须要使用作用域解析运算符，否则会发生无终止递归。（因为编译器会默认认为这里的ViewAcct是调用BrassPlus类中的方法）</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;Maximum loan: $&quot;</span> &lt;&lt; maxLoan &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Owed to bank: $&quot;</span> &lt;&lt; owesBank &lt;&lt; endl;<br>    cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">3</span>);  <span class="hljs-comment">// ###.### format</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;Loan Rate: &quot;</span> &lt;&lt; <span class="hljs-number">100</span> * rate &lt;&lt; <span class="hljs-string">&quot;%\n&quot;</span>;<br>    <span class="hljs-built_in">restore</span>(initialState, prec); <br>&#125;<br><br><span class="hljs-comment">// redefine how Withdraw() works</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BrassPlus::Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// set up ###.## format</span><br>    format initialState = <span class="hljs-built_in">setFormat</span>();<br>    precis prec = cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">2</span>);<br><br>    <span class="hljs-type">double</span> bal = <span class="hljs-built_in">Balance</span>();<br>    <span class="hljs-keyword">if</span> (amt &lt;= bal)<br>        Brass::<span class="hljs-built_in">Withdraw</span>(amt);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( amt &lt;= bal + maxLoan - owesBank)<br>    &#123;<br>        <span class="hljs-type">double</span> advance = amt - bal;<br>        owesBank += advance * (<span class="hljs-number">1.0</span> + rate);<br>        cout &lt;&lt; <span class="hljs-string">&quot;Bank advance: $&quot;</span> &lt;&lt; advance &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Finance charge: $&quot;</span> &lt;&lt; advance * rate &lt;&lt; endl;<br>        <span class="hljs-built_in">Deposit</span>(advance);<br>        Brass::<span class="hljs-built_in">Withdraw</span>(amt);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Credit limit exceeded. Transaction cancelled.\n&quot;</span>;<br>    <span class="hljs-built_in">restore</span>(initialState, prec); <br>&#125;<br><br><span class="hljs-function">format <span class="hljs-title">setFormat</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// set up ###.## format</span><br>    <span class="hljs-keyword">return</span> cout.<span class="hljs-built_in">setf</span>(std::ios_base::fixed, <br>                std::ios_base::floatfield);<br>&#125; <br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">restore</span><span class="hljs-params">(format f, precis p)</span></span><br><span class="hljs-function"></span>&#123;<br>    cout.<span class="hljs-built_in">setf</span>(f, std::ios_base::floatfield);<br>    cout.<span class="hljs-built_in">precision</span>(p);<br>&#125;<br><br></code></pre></td></tr></table></figure>

<blockquote>
<p>代码除了注意在定义同名函数的时候<strong>使用作用域运算符以防混淆</strong>，其他都和类的继承的语法知识点没有太多的联系，可自行跳过。</p>
</blockquote>
<h3 id="静态联编和动态联编"><a href="#静态联编和动态联编" class="headerlink" title="静态联编和动态联编"></a>静态联编和动态联编</h3><p><strong>函数名联编：</strong>将源代码的函数调用解释为执行特定的函数代码块。</p>
<p>如果编译器在<strong>编译时</strong>完成了这种联编，那么被称为<strong>静态联编</strong>。但是，由于虚函数的存在，OOP的<strong>多态性</strong>让这种行为变得困难（虚函数保证了调用的函数和对象的实际类型相匹配，而基类指针即可以指向派生类也可以指向基类，这就让编译器很难确定调用哪一个函数）。因此，编译器生成一种<strong>在程序运行时选择正确的虚方法的代码</strong>，这种方法被称为<strong>动态联编</strong>。</p>
<blockquote>
<p>和<strong>动态内存分配</strong>有着异曲同工之妙！如果需要再程序运行时确定数组的大小N，则需要使用动态内存分配的方法在程序运行时动态地在<strong>堆</strong>上分配相匹配的内存容量。</p>
</blockquote>
<h4 id="指针和引用类型的兼容性"><a href="#指针和引用类型的兼容性" class="headerlink" title="指针和引用类型的兼容性"></a>指针和引用类型的兼容性</h4><p>（这一块有点复杂并且无聊，笔者直接给出结论）</p>
<ul>
<li><strong>向上强制转换</strong>：将派生类应用或指针转换为基类引用或指针<ul>
<li>不需要进行显式类型转换（is-a关系可以看做一种子集关系）</li>
<li>具有可传递性和兼容性</li>
</ul>
</li>
<li><strong>向下强制转换</strong>：将基类应用或指针转换为派生类引用或指针<ul>
<li>必须使用显式类型转换</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-comment">// 基类的虚函数</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Base class display&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Base</span>() &#123;&#125;  <span class="hljs-comment">// 虚析构函数，确保派生类对象能够被正确销毁</span><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>&#123;  <span class="hljs-comment">// 派生类重写 display 函数</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Derived class display&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">show</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-comment">// 派生类的特有函数</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Derived class show&quot;</span> &lt;&lt; endl;<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 向上转换</span><br>    Derived derivedObj;<br>    Base* basePtr = &amp;derivedObj;  <span class="hljs-comment">// Derived* -&gt; Base* 向上转换</span><br><br>    <span class="hljs-comment">// 使用 basePtr 调用 display()，实际调用的是 Derived 的 display()</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;Using basePtr (upcasting):&quot;</span> &lt;&lt; endl;<br>    basePtr-&gt;<span class="hljs-built_in">display</span>();  <span class="hljs-comment">// 输出: Derived class display</span><br><br>    <span class="hljs-comment">// 向下转换</span><br>    Derived* derivedPtr = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(basePtr);  <span class="hljs-comment">// Base* -&gt; Derived* 向下转换</span><br>    <span class="hljs-keyword">if</span> (derivedPtr) &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Using derivedPtr (downcasting):&quot;</span> &lt;&lt; endl;<br>        derivedPtr-&gt;<span class="hljs-built_in">show</span>();  <span class="hljs-comment">// 输出: Derived class show</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Downcasting failed&quot;</span> &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-comment">// 向下转换失败的例子</span><br>    Base* anotherBasePtr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Base</span>();  <span class="hljs-comment">// 创建一个纯 Base 类型的对象</span><br>    Derived* failedCastPtr = <span class="hljs-built_in">dynamic_cast</span>&lt;Derived*&gt;(anotherBasePtr);  <span class="hljs-comment">// Base* -&gt; Derived* 向下转换（尝试转换但是转换失败）</span><br>    <span class="hljs-keyword">if</span> (failedCastPtr) &#123;<br>        failedCastPtr-&gt;<span class="hljs-built_in">show</span>();  <span class="hljs-comment">// 不会执行到这里</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Failed downcasting Base* to Derived*&quot;</span> &lt;&lt; endl;  <span class="hljs-comment">// 输出: Failed downcasting Base* to Derived*</span><br>    &#125;<br><br>    <span class="hljs-keyword">delete</span> anotherBasePtr;  <span class="hljs-comment">// 释放内存</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="虚函数成员和动态联编"><a href="#虚函数成员和动态联编" class="headerlink" title="虚函数成员和动态联编"></a>虚函数成员和动态联编</h4><blockquote>
<p>在原书中，此节介绍了三部分知识：</p>
<ul>
<li>为什么有两种类型的联编</li>
<li>动态联编为何不设置为默认的联编方式</li>
<li>动态联编的工作原理<ul>
<li>虚函数表</li>
</ul>
</li>
</ul>
</blockquote>
<p>在本文中，我们暂且跳过这一部分，把重点放在虚函数使用的相关注意事项：</p>
<div class="note note-info">
            <ul><li><p>在基类方法的声明中使用关键字 <code>virtual</code> 可使该方法在基类以及所有的派生类（包括从派生类派生出来的类）中是虚的。</p></li><li><p>如果使用指向对象的引用或指针来调用虚方法，程序将使用为对象类型定义的方法，而不使用为引用或指针类型定义的方法。这称为动态联编或晚期联编。这种行为非常重要，因为这样<strong>基类指针或引用可以指向派生类对象</strong>。</p></li><li><p>如果定义的类将被用作基类，则应将那些要在派生类中重新定义的类方法声明为虚的。</p></li><li><p>构造函数不能是虚函数。</p><ul><li>创建派生类对象时会调用基类的构造函数，所以没啥意义。（反正肯定会被调用）</li></ul></li><li><p><strong>析构函数应当是虚函数。</strong></p><ul><li>如果派生类新定义了动态内存分配，那么在调用时如果基类的析构函数不是虚函数，那么如果一个基类指针指向了派生类对象，在调用析构函数的时候会<strong>调用基类的析构函数</strong>，这在派生类中新定义的成员不会被<code>delete</code>掉，产生内存泄漏。</li></ul></li><li><p>友元不能是虚函数（友元不是类成员）</p></li><li><p>重新定义的问题</p><ul><li><p>如果派生类没有重新定义函数，就直接使用基类的版本。</p></li><li><p>如果派生类位于派生链中（一串派生类），那么使用<strong>最新的虚函数版本</strong>。</p></li><li><p><strong>重新定义基类的方法不是重载。</strong>如果在派生类中重新定义函数，将不是使用相同的函数特征标覆盖基类声明，而是隐藏同名的基类方法，不管参数特征标如何。</p><ul><li><p>如果重新定义继承的方法，应确保与原来的原型完全相同，但如果返回类型是基类引用或指针，则可以修改为指向派生类的引用或指针（这种例外是新出现的）。这种特性被称为返回类型协变（covariance of return type），因为允许返回类型随类类型的变化而变化。</p></li><li><p>如果基类声明被重载，应该在派生类中重新定义所有的基类版本。</p></li></ul></li></ul></li></ul>
          </div>

<p><img src="https://ooo.0x0.ooo/2025/01/11/OEfRai.png" srcset="/img/loading.gif" lazyload alt="Covirance of Return Type"></p>
<p><img src="https://ooo.0x0.ooo/2025/01/11/OEftNX.png" srcset="/img/loading.gif" lazyload alt="基类声明被重载"></p>
<h2 id="Protected"><a href="#Protected" class="headerlink" title="Protected"></a>Protected</h2><p>我们使用<code>public</code>和<code>private</code>来实现对类成员访问权限的控制。同时，我们存在<code>protected</code>关键词。</p>
<ul>
<li>与<code>private</code>相比，<code>protected</code>可以被派生类成员直接访问。</li>
<li>与<code>public</code>相比，<code>protected</code><strong>只能</strong>被派生类成员直接访问，而不能在外部直接访问。</li>
</ul>
<blockquote>
<p>通过protected的实现，基类终于给派生类赋予了一些在访问上的<strong>特权</strong>！</p>
</blockquote>
<h2 id="Abstract-Base-Class"><a href="#Abstract-Base-Class" class="headerlink" title="Abstract Base Class"></a>Abstract Base Class</h2><p>在is-a关系中，我们希望<strong>派生类 is a kind of 基类</strong>，因为这样派生类使用基类的成员方法才有意义。但是有些时候使用基类的方法会成为累赘。</p>
<blockquote>
<p>例如圆是一种特殊的椭圆。在基类椭圆类中，我们可能会定义椭圆的一些参数和方法，比如长轴短轴离心率，在继承给圆的时候，当然可以把<strong>圆看做一种特殊的椭圆</strong>。但是实际上如果从零开始设计圆类，我们可能只需要圆心和半径即可，这样基类的方法反而是一种使问题变的更加复杂的累赘。</p>
</blockquote>
<p>因此，我们可以<strong>从圆和椭圆中提取出抽象的共性，放在一个抽象基类（ABC）中，比如计算面积等方法</strong>，实现代码的重用。如果抽象基类没有包含必要的数据成员来实现有共性的函数，C++使用<strong>纯虚函数（pure virtual function）</strong>提供未实现的函数。</p>
<blockquote>
<p>ABC是一种很高深的思想，万事万物的本质原理是什么？亚里士多德提出了<strong>第一性原理</strong>的阐释。在C++中，抽象基类便像第一性原理，后续的派生类都建立在抽象基类的基础之上。真可谓一生二，二生三，三生万物。这便是ABC的哲学！</p>
</blockquote>
<p>我们来看代码的示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// acctabc.h  -- bank account classes</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> ACCTABC_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ACCTABC_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-comment">// Abstract Base Class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AcctABC</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    std::string fullName;<br>    <span class="hljs-type">long</span> acctNum;<br>    <span class="hljs-type">double</span> balance;<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Formatting</span> <br>    &#123;<br>        std::ios_base::fmtflags flag;<br>        std::streamsize pr;<br>        <span class="hljs-comment">//用来设置和恢复格式</span><br>    &#125;;<br>    <span class="hljs-function"><span class="hljs-type">const</span> std::string &amp; <span class="hljs-title">FullName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<span class="hljs-keyword">return</span> fullName;&#125;<br>    <span class="hljs-function"><span class="hljs-type">long</span> <span class="hljs-title">AcctNum</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<span class="hljs-keyword">return</span> acctNum;&#125;<br>    <span class="hljs-function">Formatting <span class="hljs-title">SetFormat</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Restore</span><span class="hljs-params">(Formatting &amp; f)</span> <span class="hljs-type">const</span></span>;<br><span class="hljs-keyword">public</span>: <br>    <span class="hljs-built_in">AcctABC</span>(<span class="hljs-type">const</span> std::string &amp; s = <span class="hljs-string">&quot;Nullbody&quot;</span>, <span class="hljs-type">long</span> an = <span class="hljs-number">-1</span>,<br>                <span class="hljs-type">double</span> bal = <span class="hljs-number">0.0</span>);<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Deposit</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span> </span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span> </span>= <span class="hljs-number">0</span>; <span class="hljs-comment">// pure virtual function</span><br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Balance</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123;<span class="hljs-keyword">return</span> balance;&#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;     <span class="hljs-comment">// pure virtual function</span><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">AcctABC</span>() &#123;&#125;<br>    <span class="hljs-comment">//提供纯虚函数接口</span><br>&#125;;<br><br><span class="hljs-comment">// Brass Account Class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Brass</span> :<span class="hljs-keyword">public</span> AcctABC<br>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Brass</span>(<span class="hljs-type">const</span> std::string &amp; s = <span class="hljs-string">&quot;Nullbody&quot;</span>, <span class="hljs-type">long</span> an = <span class="hljs-number">-1</span>,<br>           <span class="hljs-type">double</span> bal = <span class="hljs-number">0.0</span>) : <span class="hljs-built_in">AcctABC</span>(s, an, bal) &#123; &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Brass</span>() &#123;&#125;<br>&#125;;<br><br><span class="hljs-comment">//Brass Plus Account Class</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BrassPlus</span> : <span class="hljs-keyword">public</span> AcctABC<br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">double</span> maxLoan;<br>    <span class="hljs-type">double</span> rate;<br>    <span class="hljs-type">double</span> owesBank;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> std::string &amp; s = <span class="hljs-string">&quot;Nullbody&quot;</span>, <span class="hljs-type">long</span> an = <span class="hljs-number">-1</span>,<br>            <span class="hljs-type">double</span> bal = <span class="hljs-number">0.0</span>, <span class="hljs-type">double</span> ml = <span class="hljs-number">500</span>,<br>            <span class="hljs-type">double</span> r = <span class="hljs-number">0.10</span>);<br>    <span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> Brass &amp; ba, <span class="hljs-type">double</span> ml = <span class="hljs-number">500</span>, <span class="hljs-type">double</span> r = <span class="hljs-number">0.1</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">ViewAcct</span><span class="hljs-params">()</span><span class="hljs-type">const</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span>;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetMax</span><span class="hljs-params">(<span class="hljs-type">double</span> m)</span> </span>&#123; maxLoan = m; &#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetRate</span><span class="hljs-params">(<span class="hljs-type">double</span> r)</span> </span>&#123; rate = r; &#125;;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ResetOwes</span><span class="hljs-params">()</span> </span>&#123; owesBank = <span class="hljs-number">0</span>; &#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<p>以下是一些对代码和抽象基类的解读：</p>
<ul>
<li>纯虚函数在声明时需要再尾部加上”0”。</li>
<li>ABC的主要作用是为<strong>派生类提供一些共性的纯虚函数接口</strong>。</li>
</ul>
<p>我们来看一看函数定义中纯虚函数是怎么定义的。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// acctabc.cpp -- bank account class methods</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;acctabc.h&quot;</span></span><br><span class="hljs-keyword">using</span> std::cout;<br><span class="hljs-keyword">using</span> std::ios_base;<br><span class="hljs-keyword">using</span> std::endl;<br><span class="hljs-keyword">using</span> std::string;<br><br><span class="hljs-comment">// Abstract Base Class</span><br>AcctABC::<span class="hljs-built_in">AcctABC</span>(<span class="hljs-type">const</span> string &amp; s, <span class="hljs-type">long</span> an, <span class="hljs-type">double</span> bal)<br>&#123;<br>    fullName = s;<br>    acctNum = an;<br>    balance = bal;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AcctABC::Deposit</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (amt &lt; <span class="hljs-number">0</span>)<br>        cout &lt;&lt; <span class="hljs-string">&quot;Negative deposit not allowed; &quot;</span>&lt;&lt; <span class="hljs-string">&quot;deposit is cancelled.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span><br>        balance += amt;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AcctABC::Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    balance -= amt;<br>&#125;<br><br><span class="hljs-comment">// protected methods for formatting</span><br><span class="hljs-function">AcctABC::Formatting <span class="hljs-title">AcctABC::SetFormat</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br> <span class="hljs-comment">// set up ###.## format</span><br>    Formatting f;<br>    f.flag = <br>        cout.<span class="hljs-built_in">setf</span>(ios_base::fixed, ios_base::floatfield);<br>    f.pr = cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">return</span> f; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AcctABC::Restore</span><span class="hljs-params">(Formatting &amp; f)</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    cout.<span class="hljs-built_in">setf</span>(f.flag, ios_base::floatfield);<br>    cout.<span class="hljs-built_in">precision</span>(f.pr);<br>&#125;<br><br><span class="hljs-comment">// Brass methods</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Brass::Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (amt &lt; <span class="hljs-number">0</span>)<br>        cout &lt;&lt; <span class="hljs-string">&quot;Withdrawal amount must be positive; &quot;</span><br>             &lt;&lt; <span class="hljs-string">&quot;withdrawal canceled.\n&quot;</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (amt &lt;= <span class="hljs-built_in">Balance</span>())<br>        AcctABC::<span class="hljs-built_in">Withdraw</span>(amt);<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Withdrawal amount of $&quot;</span> &lt;&lt; amt<br>             &lt;&lt; <span class="hljs-string">&quot; exceeds your balance.\n&quot;</span><br>             &lt;&lt; <span class="hljs-string">&quot;Withdrawal canceled.\n&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Brass::ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>   <br>    Formatting f = <span class="hljs-built_in">SetFormat</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;Brass Client: &quot;</span> &lt;&lt; <span class="hljs-built_in">FullName</span>() &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Account Number: &quot;</span> &lt;&lt; <span class="hljs-built_in">AcctNum</span>() &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Balance: $&quot;</span> &lt;&lt; <span class="hljs-built_in">Balance</span>() &lt;&lt; endl;<br>    <span class="hljs-built_in">Restore</span>(f);<br>&#125;<br><br><span class="hljs-comment">// BrassPlus Methods</span><br>BrassPlus::<span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> string &amp; s, <span class="hljs-type">long</span> an, <span class="hljs-type">double</span> bal,<br>           <span class="hljs-type">double</span> ml, <span class="hljs-type">double</span> r) : <span class="hljs-built_in">AcctABC</span>(s, an, bal)<br>&#123;<br>    maxLoan = ml;<br>    owesBank = <span class="hljs-number">0.0</span>;<br>    rate = r; <br>&#125;<br><br>BrassPlus::<span class="hljs-built_in">BrassPlus</span>(<span class="hljs-type">const</span> Brass &amp; ba, <span class="hljs-type">double</span> ml, <span class="hljs-type">double</span> r)<br>           : <span class="hljs-built_in">AcctABC</span>(ba)   <span class="hljs-comment">// uses implicit copy constructor</span><br>&#123;<br>    maxLoan = ml;<br>    owesBank = <span class="hljs-number">0.0</span>;<br>    rate = r;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BrassPlus::ViewAcct</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span><br><span class="hljs-function"></span>&#123;<br>    Formatting f = <span class="hljs-built_in">SetFormat</span>();<br><br>    cout &lt;&lt; <span class="hljs-string">&quot;BrassPlus Client: &quot;</span> &lt;&lt; <span class="hljs-built_in">FullName</span>() &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Account Number: &quot;</span> &lt;&lt; <span class="hljs-built_in">AcctNum</span>() &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Balance: $&quot;</span> &lt;&lt; <span class="hljs-built_in">Balance</span>() &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Maximum loan: $&quot;</span> &lt;&lt; maxLoan &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Owed to bank: $&quot;</span> &lt;&lt; owesBank &lt;&lt; endl;<br>    cout.<span class="hljs-built_in">precision</span>(<span class="hljs-number">3</span>);<br>    cout &lt;&lt; <span class="hljs-string">&quot;Loan Rate: &quot;</span> &lt;&lt; <span class="hljs-number">100</span> * rate &lt;&lt; <span class="hljs-string">&quot;%\n&quot;</span>;<br>    <span class="hljs-built_in">Restore</span>(f);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">BrassPlus::Withdraw</span><span class="hljs-params">(<span class="hljs-type">double</span> amt)</span></span><br><span class="hljs-function"></span>&#123;<br>    Formatting f = <span class="hljs-built_in">SetFormat</span>();<br><br>    <span class="hljs-type">double</span> bal = <span class="hljs-built_in">Balance</span>();<br>    <span class="hljs-keyword">if</span> (amt &lt;= bal)<br>        AcctABC::<span class="hljs-built_in">Withdraw</span>(amt);<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( amt &lt;= bal + maxLoan - owesBank)<br>    &#123;<br>        <span class="hljs-type">double</span> advance = amt - bal;<br>        owesBank += advance * (<span class="hljs-number">1.0</span> + rate);<br>        cout &lt;&lt; <span class="hljs-string">&quot;Bank advance: $&quot;</span> &lt;&lt; advance &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;Finance charge: $&quot;</span> &lt;&lt; advance * rate &lt;&lt; endl;<br>        <span class="hljs-built_in">Deposit</span>(advance);<br>        AcctABC::<span class="hljs-built_in">Withdraw</span>(amt);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Credit limit exceeded. Transaction cancelled.\n&quot;</span>;<br>    <span class="hljs-built_in">Restore</span>(f); <br>&#125;<br><br></code></pre></td></tr></table></figure>

<h2 id="继承和动态内存分配"><a href="#继承和动态内存分配" class="headerlink" title="继承和动态内存分配"></a>继承和动态内存分配</h2><p>在阅读这一部分之前，建议读者先阅读<a href="https://xiyuanyang-code.github.io/posts/Dynamic-Memory-and-Classes/">第十二章</a>了解有关C++中的复制构造函数，析构函数，赋值运算符等等相关知识。本部分将继续围绕在类的继承背景下，如何实现动态内存分配。</p>
<h3 id="派生类不使用new"><a href="#派生类不使用new" class="headerlink" title="派生类不使用new"></a>派生类不使用<code>new</code></h3><p>先来看这样一个使用动态内存分配的基类：</p>
<p><img src="https://ooo.0x0.ooo/2025/01/11/OEfJdL.png" srcset="/img/loading.gif" lazyload alt="baseDMA"></p>
<p>这个基类动态分配内存给一个指向字符的指针（<strong>涉及到了按址传递，故使用默认的复制构造函数会存在风险</strong>），同时也手动定义了显式的赋值运算符，复制构造函数和析构函数。那么，如果以此为基类的派生类没有使用动态内存分配，便<strong>不需要再为派生类显式地定义显式析构函数，复制构造函数和重载赋值运算符。</strong></p>
<blockquote>
<p>为什么？你当然可以显式定义，但没有任何的必要。因为默认的赋值运算符和复制构造函数都是在使用动态内存时会产生冲突，基类的动态内存已经手动显示定义，故不存在隐患。</p>
<p>在复制类所继承的类组件时，会优先使用被继承类的显式构造函数。（对赋值同样也是如此）</p>
</blockquote>
<h3 id="派生类使用new"><a href="#派生类使用new" class="headerlink" title="派生类使用new"></a>派生类使用<code>new</code></h3><p>这便是更加复杂的情况，我们来看一个使用动态内存的派生类：</p>
<p><img src="https://ooo.0x0.ooo/2025/01/11/OEfJdL.png" srcset="/img/loading.gif" lazyload alt="Derived Class with DMA.png"></p>
<div class="note note-danger">
            <p><strong>在这种情况下，必须为派生类定义显式析构函数、复制构造函数和赋值运算符 。</strong>因为派生类添加了新的数据成员使用动态内存分配，而基类的方法中并不包含这个成员的操作。因此需要额外定义来防止内存泄漏等严重问题。</p>
          </div>

<h3 id="使用友元"><a href="#使用友元" class="headerlink" title="使用友元"></a>使用友元</h3><p>来看下面的综合代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// dma.h  -- inheritance and dynamic memory allocation</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> DMA_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> DMA_H_</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-comment">//  Base Class Using DMA</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">baseDMA</span><br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">char</span> * label;<br>    <span class="hljs-type">int</span> rating;<br>    <br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">baseDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * l = <span class="hljs-string">&quot;null&quot;</span>, <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">baseDMA</span>(<span class="hljs-type">const</span> baseDMA &amp; rs);<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">baseDMA</span>();<br>    <span class="hljs-comment">//使用虚函数</span><br>    baseDMA &amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> baseDMA &amp; rs);<br>    <span class="hljs-keyword">friend</span> std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <br>                                     <span class="hljs-type">const</span> baseDMA &amp; rs);<br>    <span class="hljs-comment">//友元函数（流输出运算符）</span><br>&#125;;<br><br><span class="hljs-comment">// derived class without DMA</span><br><span class="hljs-comment">// no destructor needed</span><br><span class="hljs-comment">// uses implicit copy constructor</span><br><span class="hljs-comment">// uses implicit assignment operator</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">lacksDMA</span> :<span class="hljs-keyword">public</span> baseDMA<br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">enum</span> &#123; COL_LEN = <span class="hljs-number">40</span>&#125;;<br>    <span class="hljs-type">char</span> color[COL_LEN];<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">lacksDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * c = <span class="hljs-string">&quot;blank&quot;</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * l = <span class="hljs-string">&quot;null&quot;</span>,<br>              <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">lacksDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * c, <span class="hljs-type">const</span> baseDMA &amp; rs);<br>    <span class="hljs-keyword">friend</span> std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <br>                                     <span class="hljs-type">const</span> lacksDMA &amp; rs);<br>&#125;;<br><br><span class="hljs-comment">// derived class with DMA</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">hasDMA</span> :<span class="hljs-keyword">public</span> baseDMA<br>&#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">char</span> * style;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * s = <span class="hljs-string">&quot;none&quot;</span>, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * l = <span class="hljs-string">&quot;null&quot;</span>,<br>              <span class="hljs-type">int</span> r = <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * s, <span class="hljs-type">const</span> baseDMA &amp; rs);<br>    <span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> hasDMA &amp; hs);<br>    ~<span class="hljs-built_in">hasDMA</span>();<br>    hasDMA &amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> hasDMA &amp; rs);  <br>    <span class="hljs-keyword">friend</span> std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <br>                                     <span class="hljs-type">const</span> hasDMA &amp; rs);<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// dma.cpp --dma class methods</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;dma.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span><br><br><span class="hljs-comment">// baseDMA methods</span><br>baseDMA::<span class="hljs-built_in">baseDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * l, <span class="hljs-type">int</span> r)<br>&#123;<br>    label = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(l) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(label, l);<br>    rating = r;<br>&#125;<br><br>baseDMA::<span class="hljs-built_in">baseDMA</span>(<span class="hljs-type">const</span> baseDMA &amp; rs)<br>&#123;<br>    label = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(rs.label) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(label, rs.label);<br>    rating = rs.rating;<br>&#125;<br><br>baseDMA::~<span class="hljs-built_in">baseDMA</span>()<br>&#123;<br>    <span class="hljs-keyword">delete</span> [] label;<br>&#125;<br><br>baseDMA &amp; baseDMA::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> baseDMA &amp; rs)<br>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == &amp;rs)<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    <span class="hljs-keyword">delete</span> [] label;<br>    label = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(rs.label) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(label, rs.label);<br>    rating = rs.rating;<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br>    <br>std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <span class="hljs-type">const</span> baseDMA &amp; rs)<br>&#123;<br>    os &lt;&lt; <span class="hljs-string">&quot;Label: &quot;</span> &lt;&lt; rs.label &lt;&lt; std::endl;<br>    os &lt;&lt; <span class="hljs-string">&quot;Rating: &quot;</span> &lt;&lt; rs.rating &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> os;<br>&#125;<br><br><span class="hljs-comment">// lacksDMA methods</span><br>lacksDMA::<span class="hljs-built_in">lacksDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * c, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * l, <span class="hljs-type">int</span> r)<br>    : <span class="hljs-built_in">baseDMA</span>(l, r)<br>&#123;<br>    std::<span class="hljs-built_in">strncpy</span>(color, c, <span class="hljs-number">39</span>);<br>    color[<span class="hljs-number">39</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>&#125;<br><br>lacksDMA::<span class="hljs-built_in">lacksDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * c, <span class="hljs-type">const</span> baseDMA &amp; rs)<br>    : <span class="hljs-built_in">baseDMA</span>(rs)<br>&#123;<br>    std::<span class="hljs-built_in">strncpy</span>(color, c, COL_LEN - <span class="hljs-number">1</span>);<br>    color[COL_LEN - <span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>&#125;<br><br>std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <span class="hljs-type">const</span> lacksDMA &amp; ls)<br>&#123;<br>    os &lt;&lt; (<span class="hljs-type">const</span> baseDMA &amp;) ls;<br>    os &lt;&lt; <span class="hljs-string">&quot;Color: &quot;</span> &lt;&lt; ls.color &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> os;<br>&#125;<br><br><span class="hljs-comment">// hasDMA methods</span><br>hasDMA::<span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * s, <span class="hljs-type">const</span> <span class="hljs-type">char</span> * l, <span class="hljs-type">int</span> r)<br>         : <span class="hljs-built_in">baseDMA</span>(l, r)<br>&#123;<br>    style = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(s) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(style, s);<br>&#125;<br><br>hasDMA::<span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> * s, <span class="hljs-type">const</span> baseDMA &amp; rs)<br>         : <span class="hljs-built_in">baseDMA</span>(rs)<br>&#123;<br>    style = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(s) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(style, s);<br>&#125;<br><br>hasDMA::<span class="hljs-built_in">hasDMA</span>(<span class="hljs-type">const</span> hasDMA &amp; hs)<br>         : <span class="hljs-built_in">baseDMA</span>(hs)  <span class="hljs-comment">// invoke base class copy constructor</span><br>&#123;<br>    style = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(hs.style) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(style, hs.style);<br>&#125;<br><br>hasDMA::~<span class="hljs-built_in">hasDMA</span>()<br>&#123;<br>    <span class="hljs-keyword">delete</span> [] style;<br>&#125;<br><br>hasDMA &amp; hasDMA::<span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> hasDMA &amp; hs)<br>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == &amp;hs)<br>        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>    baseDMA::<span class="hljs-keyword">operator</span>=(hs);  <span class="hljs-comment">// copy base portion，赋值基类的数据成员</span><br>    <span class="hljs-comment">//这个语句等价于 *this = hs;</span><br>    <span class="hljs-keyword">delete</span> [] style;         <span class="hljs-comment">// prepare for new style</span><br>    style = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[std::<span class="hljs-built_in">strlen</span>(hs.style) + <span class="hljs-number">1</span>];<br>    std::<span class="hljs-built_in">strcpy</span>(style, hs.style);<br>    <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;<br>&#125;<br>    <br>std::ostream &amp; <span class="hljs-keyword">operator</span>&lt;&lt;(std::ostream &amp; os, <span class="hljs-type">const</span> hasDMA &amp; hs)<br>&#123;<br>    os &lt;&lt; (<span class="hljs-type">const</span> baseDMA &amp;) hs;<br>    <span class="hljs-comment">//使用强制类型转换，使得该行可以调用基类的友元函数</span><br>    os &lt;&lt; <span class="hljs-string">&quot;Style: &quot;</span> &lt;&lt; hs.style &lt;&lt; std::endl;<br>    <span class="hljs-keyword">return</span> os;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>在 C++ 中，<strong>友元函数</strong>的行为与普通成员函数不同。友元函数是 <strong>根据它所声明的类</strong> 来确定是否有权限访问该类的私有和保护成员的，而与对象的动态类型无关。因此，友元函数并不遵循 <strong>多态性</strong> 规则。</p>
<p>例如有以下代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span>;  <span class="hljs-comment">// 前置声明</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> baseValue;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Base</span>() : <span class="hljs-built_in">baseValue</span>(<span class="hljs-number">10</span>) &#123;&#125;<br><br>    <span class="hljs-comment">// 友元函数声明</span><br>    <span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-type">void</span> <span class="hljs-title">printBaseValue</span><span class="hljs-params">(Base&amp; b)</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> : <span class="hljs-keyword">public</span> Base &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">int</span> derivedValue;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">Derived</span>() : <span class="hljs-built_in">derivedValue</span>(<span class="hljs-number">20</span>) &#123;&#125;<br><br>    <span class="hljs-comment">// 友元函数声明，同名函数</span><br>    <span class="hljs-function"><span class="hljs-keyword">friend</span> <span class="hljs-type">void</span> <span class="hljs-title">printBaseValue</span><span class="hljs-params">(Derived&amp; d)</span></span>;<br>&#125;;<br><br><span class="hljs-comment">// 基类的友元函数定义</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printValue</span><span class="hljs-params">(Base&amp; b)</span> </span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Base Value: &quot;</span> &lt;&lt; b.baseValue &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-comment">// 派生类的友元函数定义</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printValue</span><span class="hljs-params">(Derived&amp; d)</span> </span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;Derived Value: &quot;</span> &lt;&lt; d.derivedValue &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    Derived d;<br>    Base* basePtr = &amp;d;  <span class="hljs-comment">// 基类指针指向派生类对象</span><br>    <span class="hljs-comment">// 使用基类指针调用基类的友元函数</span><br>    <span class="hljs-built_in">printValue</span>(*basePtr);  <span class="hljs-comment">// 将会调用 Base 类的友元函数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>输出结果：<code>Base Value: 10</code></p>
<p><code>basePtr</code>指针的类型是基类指针，但是指向了一个派生类对象。对于成员函数使用<strong>虚函数声明</strong>保证了调用的函数与实际指向的对象类型相符。（会调用派生类的函数）<strong>但友元函数虽然有访问私有数据成员的特权</strong>，但他不是成员函数，因此友元函数根据类的声明位置（即函数特征标的匹配程度）来决定调用的。在这里编译器判定<code>basePtr</code>指针的类型是基类指针，因此会调用**基类的<code>printValue()</code>**函数，哪怕它指向的是一个派生类对象。</p>
<p>这就是为什么派生类指针如果想使用基类的友元函数必须先<strong>强制类型转换成</strong>一个基类的指针（就像代码的第105~110行）。</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p><strong>恭喜你！你已经掌握OOP的基本知识，可以进行一些实操锻炼了！</strong>笔者自己在阅读10,11,12,13四章时非常的痛苦，感觉非常的不适应，但是一路走来，在掌握了OOP的哲学和最基本的原则之后，一切纷繁复杂的语法原理似乎都有理可依。</p>
<p>接下来，我们将系统梳理这四章的一些内容，受篇幅限制，本部分主要以思维导图和关键词的形式呈现，详细内容大家可以看原书的13.8节。</p>
<p>OOP的基本精神：</p>
<ul>
<li><p>封装（保证操作的安全性和便利性）</p>
<ul>
<li><code>private</code><ul>
<li>储存私有的数据成员</li>
</ul>
</li>
<li><code>public</code><ul>
<li>一些方法（函数）<ul>
<li>构造函数<ul>
<li>默认构造函数</li>
<li>复制构造函数</li>
<li>显示定义的构造函数和复制构造函数（深拷贝）</li>
</ul>
</li>
<li>析构函数（显示定义）<ul>
<li>在12节重点介绍了这些函数和<strong>动态内存分配</strong></li>
</ul>
</li>
<li>运算符重载<ul>
<li>使用友元函数，this指针</li>
<li>显示定义赋值运算符</li>
</ul>
</li>
</ul>
</li>
<li>提供了访问私有数据成员的接口</li>
<li>友元函数的声明</li>
</ul>
</li>
<li><code>protected</code><ul>
<li>基类成员给予派生类成员的一些特权</li>
</ul>
</li>
</ul>
</li>
<li><p>继承与多态</p>
<ul>
<li>基类——派生类</li>
<li>公有继承的<strong>is-a</strong>关系</li>
<li>继承函数的体系就是这一章节的目录（不再归纳）</li>
</ul>
<p><img src="https://ooo.0x0.ooo/2025/01/11/OEf4Et.png" srcset="/img/loading.gif" lazyload alt="Conclusion"></p>
</li>
</ul>
<p>当然，OOP的精神远不止于此！在接下来的第十四章，我们将更加深入的探寻<strong>C++中的其他继承关系和代码重用问题。</strong></p>
<div class="note note-info">
            <p>无论如何，请你记住，面向对象编程是一种精神，而不是繁文缛节的语法。</p>
          </div>

<blockquote>
<p>THE END                     ——2024&#x2F;12&#x2F;11</p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Code/" class="category-chain-item">Code</a>
  
  
    <span>></span>
    
  <a href="/categories/Code/Cpp/" class="category-chain-item">Cpp</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/tutorial/" class="print-no-link">#tutorial</a>
      
        <a href="/tags/Finished/" class="print-no-link">#Finished</a>
      
        <a href="/tags/C-C/" class="print-no-link">#C/C++</a>
      
        <a href="/tags/OOP/" class="print-no-link">#OOP</a>
      
        <a href="/tags/C-Primer-Plus/" class="print-no-link">#C++ Primer Plus</a>
      
        <a href="/tags/Inheritance/" class="print-no-link">#Inheritance</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Class-Inheritance</div>
      <div>https://xiyuanyang-code.github.io/posts/Class-Inheritance/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Xiyuan Yang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 8, 2024</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>May 19, 2025</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/Leetcode-Mistake-collection/" title="Leetcode-Mistake-Collection">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Leetcode-Mistake-Collection</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/Linked-List-Implementation-Based-on-Structs/" title="Linked-List-Implementation-Based-on-Structs">
                        <span class="hidden-mobile">Linked-List-Implementation-Based-on-Structs</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
    <div id="giscus" class="giscus"></div>
    <script type="text/javascript">
      Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"xiyuanyang-code/xiyuanyang-code.github.io","repo-id":"R_kgDONRhvHQ","category":"Announcements","category-id":"DIC_kwDONRhvHc4ClBnp","theme-light":"light","theme-dark":"dark","mapping":"pathname","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });
    </script>
    <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://github.com/xiyuanyang-code" target="_blank" rel="nofollow noopener"><span>YXY</span></a> <a href="https://xiyuanyang-code.github.io/Loving-Count/" target="_blank" rel="nofollow noopener"><span>❤️</span></a> <a href="https://github.com/Siyan-Li" target="_blank" rel="nofollow noopener"><span>LSY</span></a> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
